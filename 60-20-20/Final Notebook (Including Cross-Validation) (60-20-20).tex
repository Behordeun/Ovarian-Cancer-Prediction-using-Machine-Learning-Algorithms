\documentclass[11pt]{article}

    \usepackage[breakable]{tcolorbox}
    \usepackage{parskip} % Stop auto-indenting (to mimic markdown behaviour)
    

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % Keep aspect ratio if custom image width or height is specified
    \setkeys{Gin}{keepaspectratio}
    % Maintain compatibility with old templates. Remove in nbconvert 6.0
    \let\Oldincludegraphics\includegraphics
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionFormat{nocaption}{}
    \captionsetup{format=nocaption,aboveskip=0pt,belowskip=0pt}

    \usepackage{float}
    \floatplacement{figure}{H} % forces figures to be placed at the correct location
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro

    \usepackage{iftex}
    \ifPDFTeX
        \usepackage[T1]{fontenc}
        \IfFileExists{alphabeta.sty}{
              \usepackage{alphabeta}
          }{
              \usepackage[mathletters]{ucs}
              \usepackage[utf8x]{inputenc}
          }
    \else
        \usepackage{fontspec}
        \usepackage{unicode-math}
    \fi

    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics
                         % to support a larger range
    \makeatletter % fix for old versions of grffile with XeLaTeX
    \@ifpackagelater{grffile}{2019/11/01}
    {
      % Do nothing on new versions
    }
    {
      \def\Gread@@xetex#1{%
        \IfFileExists{"\Gin@base".bb}%
        {\Gread@eps{\Gin@base.bb}}%
        {\Gread@@xetex@aux#1}%
      }
    }
    \makeatother
    \usepackage[Export]{adjustbox} % Used to constrain images to a maximum size
    \adjustboxset{max size={0.9\linewidth}{0.9\paperheight}}

    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    % The default LaTeX title has an obnoxious amount of whitespace. By default,
    % titling removes some of it. It also provides customization options.
    \usepackage{titling}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage{array}     % table support for pandoc >= 2.11.3
    \usepackage{calc}      % table minipage width calculation for pandoc >= 2.11.1
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    \usepackage{soul}      % strikethrough (\st) support for pandoc >= 3.0.0
    \usepackage{mathrsfs}
    

    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}
    \definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
    \definecolor{ansi-default-inverse-bg}{HTML}{000000}

    % common color for the border for error outputs.
    \definecolor{outerrorbackground}{HTML}{FFDFDF}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}

    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}


    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatibility definitions
    \def\gt{>}
    \def\lt{<}
    \let\Oldtex\TeX
    \let\Oldlatex\LaTeX
    \renewcommand{\TeX}{\textrm{\Oldtex}}
    \renewcommand{\LaTeX}{\textrm{\Oldlatex}}
    % Document parameters
    % Document title
    \title{Final Notebook (Including Cross-Validation) (60-20-20)}
    
    
    
    
    
    
    
% Pygments definitions
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\@namedef{PY@tok@w}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\@namedef{PY@tok@c}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cp}{\def\PY@tc##1{\textcolor[rgb]{0.61,0.40,0.00}{##1}}}
\@namedef{PY@tok@k}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kt}{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\@namedef{PY@tok@o}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ow}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@nb}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nf}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@ne}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.80,0.25,0.22}{##1}}}
\@namedef{PY@tok@nv}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@no}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\@namedef{PY@tok@nl}{\def\PY@tc##1{\textcolor[rgb]{0.46,0.46,0.00}{##1}}}
\@namedef{PY@tok@ni}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@na}{\def\PY@tc##1{\textcolor[rgb]{0.41,0.47,0.13}{##1}}}
\@namedef{PY@tok@nt}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nd}{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@s}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sd}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@si}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@se}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.36,0.12}{##1}}}
\@namedef{PY@tok@sr}{\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@ss}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sx}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@m}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@gh}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@gu}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\@namedef{PY@tok@gd}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\@namedef{PY@tok@gi}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.52,0.00}{##1}}}
\@namedef{PY@tok@gr}{\def\PY@tc##1{\textcolor[rgb]{0.89,0.00,0.00}{##1}}}
\@namedef{PY@tok@ge}{\let\PY@it=\textit}
\@namedef{PY@tok@gs}{\let\PY@bf=\textbf}
\@namedef{PY@tok@ges}{\let\PY@bf=\textbf\let\PY@it=\textit}
\@namedef{PY@tok@gp}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@go}{\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@gt}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\@namedef{PY@tok@err}{\def\PY@bc##1{{\setlength{\fboxsep}{\string -\fboxrule}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}}
\@namedef{PY@tok@kc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kd}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kr}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@bp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@fm}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@vc}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vg}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vi}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vm}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sa}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sb}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sc}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@dl}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s2}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sh}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s1}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@mb}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mf}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mh}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mi}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@il}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mo}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ch}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cm}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cpf}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@c1}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cs}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % For linebreaks inside Verbatim environment from package fancyvrb.
    \makeatletter
        \newbox\Wrappedcontinuationbox
        \newbox\Wrappedvisiblespacebox
        \newcommand*\Wrappedvisiblespace {\textcolor{red}{\textvisiblespace}}
        \newcommand*\Wrappedcontinuationsymbol {\textcolor{red}{\llap{\tiny$\m@th\hookrightarrow$}}}
        \newcommand*\Wrappedcontinuationindent {3ex }
        \newcommand*\Wrappedafterbreak {\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox}
        % Take advantage of the already applied Pygments mark-up to insert
        % potential linebreaks for TeX processing.
        %        {, <, #, %, $, ' and ": go to next line.
        %        _, }, ^, &, >, - and ~: stay at end of broken line.
        % Use of \textquotesingle for straight quote.
        \newcommand*\Wrappedbreaksatspecials {%
            \def\PYGZus{\discretionary{\char`\_}{\Wrappedafterbreak}{\char`\_}}%
            \def\PYGZob{\discretionary{}{\Wrappedafterbreak\char`\{}{\char`\{}}%
            \def\PYGZcb{\discretionary{\char`\}}{\Wrappedafterbreak}{\char`\}}}%
            \def\PYGZca{\discretionary{\char`\^}{\Wrappedafterbreak}{\char`\^}}%
            \def\PYGZam{\discretionary{\char`\&}{\Wrappedafterbreak}{\char`\&}}%
            \def\PYGZlt{\discretionary{}{\Wrappedafterbreak\char`\<}{\char`\<}}%
            \def\PYGZgt{\discretionary{\char`\>}{\Wrappedafterbreak}{\char`\>}}%
            \def\PYGZsh{\discretionary{}{\Wrappedafterbreak\char`\#}{\char`\#}}%
            \def\PYGZpc{\discretionary{}{\Wrappedafterbreak\char`\%}{\char`\%}}%
            \def\PYGZdl{\discretionary{}{\Wrappedafterbreak\char`\$}{\char`\$}}%
            \def\PYGZhy{\discretionary{\char`\-}{\Wrappedafterbreak}{\char`\-}}%
            \def\PYGZsq{\discretionary{}{\Wrappedafterbreak\textquotesingle}{\textquotesingle}}%
            \def\PYGZdq{\discretionary{}{\Wrappedafterbreak\char`\"}{\char`\"}}%
            \def\PYGZti{\discretionary{\char`\~}{\Wrappedafterbreak}{\char`\~}}%
        }
        % Some characters . , ; ? ! / are not pygmentized.
        % This macro makes them "active" and they will insert potential linebreaks
        \newcommand*\Wrappedbreaksatpunct {%
            \lccode`\~`\.\lowercase{\def~}{\discretionary{\hbox{\char`\.}}{\Wrappedafterbreak}{\hbox{\char`\.}}}%
            \lccode`\~`\,\lowercase{\def~}{\discretionary{\hbox{\char`\,}}{\Wrappedafterbreak}{\hbox{\char`\,}}}%
            \lccode`\~`\;\lowercase{\def~}{\discretionary{\hbox{\char`\;}}{\Wrappedafterbreak}{\hbox{\char`\;}}}%
            \lccode`\~`\:\lowercase{\def~}{\discretionary{\hbox{\char`\:}}{\Wrappedafterbreak}{\hbox{\char`\:}}}%
            \lccode`\~`\?\lowercase{\def~}{\discretionary{\hbox{\char`\?}}{\Wrappedafterbreak}{\hbox{\char`\?}}}%
            \lccode`\~`\!\lowercase{\def~}{\discretionary{\hbox{\char`\!}}{\Wrappedafterbreak}{\hbox{\char`\!}}}%
            \lccode`\~`\/\lowercase{\def~}{\discretionary{\hbox{\char`\/}}{\Wrappedafterbreak}{\hbox{\char`\/}}}%
            \catcode`\.\active
            \catcode`\,\active
            \catcode`\;\active
            \catcode`\:\active
            \catcode`\?\active
            \catcode`\!\active
            \catcode`\/\active
            \lccode`\~`\~
        }
    \makeatother

    \let\OriginalVerbatim=\Verbatim
    \makeatletter
    \renewcommand{\Verbatim}[1][1]{%
        %\parskip\z@skip
        \sbox\Wrappedcontinuationbox {\Wrappedcontinuationsymbol}%
        \sbox\Wrappedvisiblespacebox {\FV@SetupFont\Wrappedvisiblespace}%
        \def\FancyVerbFormatLine ##1{\hsize\linewidth
            \vtop{\raggedright\hyphenpenalty\z@\exhyphenpenalty\z@
                \doublehyphendemerits\z@\finalhyphendemerits\z@
                \strut ##1\strut}%
        }%
        % If the linebreak is at a space, the latter will be displayed as visible
        % space at end of first line, and a continuation symbol starts next line.
        % Stretch/shrink are however usually zero for typewriter font.
        \def\FV@Space {%
            \nobreak\hskip\z@ plus\fontdimen3\font minus\fontdimen4\font
            \discretionary{\copy\Wrappedvisiblespacebox}{\Wrappedafterbreak}
            {\kern\fontdimen2\font}%
        }%

        % Allow breaks at special characters using \PYG... macros.
        \Wrappedbreaksatspecials
        % Breaks at punctuation characters . , ; ? ! and / need catcode=\active
        \OriginalVerbatim[#1,codes*=\Wrappedbreaksatpunct]%
    }
    \makeatother

    % Exact colors from NB
    \definecolor{incolor}{HTML}{303F9F}
    \definecolor{outcolor}{HTML}{D84315}
    \definecolor{cellborder}{HTML}{CFCFCF}
    \definecolor{cellbackground}{HTML}{F7F7F7}

    % prompt
    \makeatletter
    \newcommand{\boxspacing}{\kern\kvtcb@left@rule\kern\kvtcb@boxsep}
    \makeatother
    \newcommand{\prompt}[4]{
        {\ttfamily\llap{{\color{#2}[#3]:\hspace{3pt}#4}}\vspace{-\baselineskip}}
    }
    

    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

\begin{document}
    
    \maketitle
    
    

    
    \section{Ovarian Cancer Modelling - A comparative Analyis of Baseline
and Ensemble
Methods}\label{ovarian-cancer-modelling---a-comparative-analyis-of-baseline-and-ensemble-methods}

    \subsection{Introduction}\label{introduction}

This notebook is designed to develop machine-learning models for
detecting ovarian cancer. The main aim of this research is to utilize
various machine-learning algorithms for detecting \textbf{Ovarian
Cancer}. The code is organized into several sections.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  \hyperref[data-description]{The Data Description section} describes
  the dataset used in this research.
\item
  \hyperref[data_wrang]{The Data Wrangling section} preprocesses the
  dataset to transform raw data into a clean dataset suitable for
  training the machine learning model.
\item
  \hyperref[data_viz]{The Exploratory Data Analysis section} visualizes
  key features in the provided dataset to gain an insight into the data
  graphically.
\item
  \hyperref[data_anal]{The Preliminary Data Analysis section} explores
  the provided dataset and performs basic statistical analysis to
  understand the data better.
\item
  \hyperref[feature]{The Feature Engineering section} extracts relevant
  features from the data to improve the model's accuracy.
\item
  \hyperref[training]{The Model Training section} trains the machine
  learning model using several ensemble learning algorithms and
  evaluates their performance based on various metrics.
\item
  \hyperref[baseline_model_anal]{The Analysis of Ensemble Methods section}
  analyzes the factors that contribute to the performance of the
  selected baseline algorithms.
\item
  \hyperref[model_anal]{The Analysis of Ensemble Methods section}
  analyzes the factors that contribute to the performance of the
  selected ensemble learning algorithms.
\item
  \hyperref[model_perf_assessment]{Assessing how the Number of Features Impacts Model Performance Section}
  systematically analyzes the factors contributing to the performance of
  selected Decision Tree models using varying numbers of features
  determined by the MRMR method.
\end{enumerate}

    \subsubsection{\texorpdfstring{Data Description
}{Data Description }}\label{data-description}

This section of the code provides sufficient information about the
dataset used for this research.

The Third Affiliated Hospital of Soochow University provided the dataset
for the study, which includes 349 individuals. The data were collected
between July 2011 and July 2018, and they were divided into two groups:
178 patients with benign ovarian tumors and 171 patients with ovarian
cancer
(\href{https://www.kaggle.com/datasets/swabbie8/ovarian-cancer/data?select=ovariantotal.csv}{Kaggle},
accessed on 15 January 2024). 49 features in all, derived through
pathology diagnosis, were included in the dataset. These 49 predictor
factors included information on age and menopause, as well as 22 basic
chemical tests, 19 normal blood tests, and 6 tumor markers. Prior to
surgery, none of the patients had received chemotherapy or radiotherapy,
and all underwent postoperative case diagnosis. Using standards from the
World Health Organization, the histological diagnosis was categorized.

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
Biomarker & Biomarker Name \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
MPV & Mean platelet volume \\
BASO\# & Basophil Cell Count \\
PHOS & phosphorus \\
GLU. & glucose \\
CA72-4 & Carbohydrate antigen 72-4 \\
K & kalium \\
AST & Aspartate aminotransferase \\
BASO\% & Basophil Cell ratio \\
Mg & magnesium \\
CL & chlorine \\
CEA & Carcinoembryonic antigen \\
EO\# & eosinophil count \\
CA19-9 & Carbohydrate antigen 19-9 \\
ALB & albumin \\
IBIL & Indirect bilirubin \\
GGT & Gama glutamyltransferasey \\
MCH & Mean corpuscular hemoglubin \\
GLO & globulin \\
DBIL & direct bilirubin \\
RDW & red blood cell distribution width \\
PDW & Platelet distribution width \\
CREA & creatinine \\
AFP & alpha-fetoprotein \\
HGB & hemoglobin \\
Na & Natrium \\
HE4 & human epididymis protein 4 \\
LYM\# & lymphocyte count \\
CA125 & Carbohydrate antigen 125 \\
BUN & blood urea nitrogen \\
LYM\% & lymphocyte ratio \\
Ca & calcium \\
AG & Anion gap \\
MONO\# & mononuclear cell count \\
PLT & platelet count \\
NEU & neutrophil ratio \\
EO\% & eosinophil ratio \\
TP & Total protein \\
UA & urie acid \\
RBC & Red blood cell count \\
PCT & thrombocytocrit \\
CO2CP & carban dioxide-combining Power \\
TBIL & total bilirubin \\
HCT & hematocrit \\
MONO\% & monocyte ratio \\
MCV & mean corpuscular volume \\
ALP & Alkaline phosphatase \\
\end{longtable}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{1}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}  \PY{c+c1}{\PYZsh{} linear algebra}
\PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd} \PY{c+c1}{\PYZsh{} data processing, CSV file I/O (e.g. pd.read\PYZus{}csv)}
\PY{k+kn}{import} \PY{n+nn}{seaborn} \PY{k}{as} \PY{n+nn}{sns} \PY{c+c1}{\PYZsh{} data visualization}
\PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.} \PY{n}{pyplot} \PY{k}{as} \PY{n}{plt} \PY{c+c1}{\PYZsh{} data visualization}
\PY{k+kn}{import} \PY{n+nn}{shutil}

\PY{k+kn}{import} \PY{n+nn}{joblib}
\PY{k+kn}{import} \PY{n+nn}{pickle}
\PY{k+kn}{import} \PY{n+nn}{os}
\PY{k+kn}{import} \PY{n+nn}{time}
\PY{k+kn}{import} \PY{n+nn}{warnings}
\PY{n}{warnings}\PY{o}{.}\PY{n}{filterwarnings}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ignore}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{k+kn}{import} \PY{n+nn}{mlflow}

\PY{n}{mlflow}\PY{o}{.}\PY{n}{set\PYZus{}tracking\PYZus{}uri}\PY{p}{(}\PY{n}{uri}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{http://127.0.0.1:5000}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{mlflow}\PY{o}{.}\PY{n}{autolog}\PY{p}{(}\PY{p}{)}

\PY{k+kn}{from} \PY{n+nn}{mlflow}\PY{n+nn}{.}\PY{n+nn}{models} \PY{k+kn}{import} \PY{n}{infer\PYZus{}signature}

\PY{k+kn}{import} \PY{n+nn}{plotly}\PY{n+nn}{.}\PY{n+nn}{express} \PY{k}{as} \PY{n+nn}{px} \PY{c+c1}{\PYZsh{}data visualization}
\PY{k+kn}{import} \PY{n+nn}{plotly}\PY{n+nn}{.}\PY{n+nn}{io} \PY{k}{as} \PY{n+nn}{pio} \PY{c+c1}{\PYZsh{} plot rendering}
\PY{n}{pio}\PY{o}{.}\PY{n}{kaleido}\PY{o}{.}\PY{n}{scope}\PY{o}{.}\PY{n}{default\PYZus{}format} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{png}\PY{l+s+s2}{\PYZdq{}}
\PY{n}{pio}\PY{o}{.}\PY{n}{renderers}\PY{o}{.}\PY{n}{default} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{plotly\PYZus{}mimetype+notebook}\PY{l+s+s2}{\PYZdq{}}
\PY{k+kn}{import} \PY{n+nn}{plotly}\PY{n+nn}{.}\PY{n+nn}{figure\PYZus{}factory} \PY{k}{as} \PY{n+nn}{ff} \PY{c+c1}{\PYZsh{} data visualization}
\PY{k+kn}{import} \PY{n+nn}{plotly}\PY{n+nn}{.}\PY{n+nn}{graph\PYZus{}objects} \PY{k}{as} \PY{n+nn}{go} \PY{c+c1}{\PYZsh{} data visualization}
\PY{k+kn}{from} \PY{n+nn}{plotly}\PY{n+nn}{.}\PY{n+nn}{subplots} \PY{k+kn}{import} \PY{n}{make\PYZus{}subplots} \PY{c+c1}{\PYZsh{}  data visualization}

\PY{k+kn}{from} \PY{n+nn}{mrmr} \PY{k+kn}{import} \PY{n}{mrmr\PYZus{}classif}  \PY{c+c1}{\PYZsh{} Importing mrmr lib for top features selection}

\PY{k+kn}{from} \PY{n+nn}{IPython}\PY{n+nn}{.}\PY{n+nn}{display} \PY{k+kn}{import} \PY{n}{display}\PY{p}{,} \PY{n}{Javascript} \PY{c+c1}{\PYZsh{} utilizing JavaScript for rendering charts}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
2024/04/13 09:29:09 INFO mlflow.tracking.fluent: Autologging successfully
enabled for statsmodels.
2024/04/13 09:29:11 WARNING mlflow.utils.autologging\_utils: You are using an
unsupported version of sklearn. If you encounter errors during autologging, try
upgrading / downgrading sklearn to a supported version, or try upgrading MLflow.
2024/04/13 09:29:13 INFO mlflow.tracking.fluent: Autologging successfully
enabled for sklearn.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{2}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Create a new MLflow Experiment}
\PY{n}{mlflow}\PY{o}{.}\PY{n}{set\PYZus{}experiment}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ovarian Cancer Prediction \PYZhy{} 1}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
2024/04/13 09:29:13 INFO mlflow.tracking.fluent: Experiment with name 'Ovarian
Cancer Prediction - 1' does not exist. Creating a new experiment.
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{2}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<Experiment: artifact\_location='mlflow-artifacts:/769900333028443617',
creation\_time=1712996953765, experiment\_id='769900333028443617',
last\_update\_time=1712996953765, lifecycle\_stage='active', name='Ovarian Cancer
Prediction - 1', tags=\{\}>
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{3}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Pandas display options for easy viewing of data frames}
\PY{n}{pd}\PY{o}{.}\PY{n}{set\PYZus{}option}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{display.width}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{150}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{4}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Reading the dataset}
\PY{n}{df\PYZus{}cancer} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}excel}\PY{p}{(}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{../data/Supplementary data 1.xlsx}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{sheet\PYZus{}name}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{All Raw Data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
    \PY{n}{dtype}\PY{o}{=}\PY{n+nb}{str}
\PY{p}{)}
\PY{c+c1}{\PYZsh{} Remove trailing whitespace from all string columns}
\PY{n}{df\PYZus{}cancer} \PY{o}{=} \PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n}{x}\PY{o}{.}\PY{n}{str}\PY{o}{.}\PY{n}{rstrip}\PY{p}{(}\PY{p}{)} \PY{k}{if} \PY{n}{x}\PY{o}{.}\PY{n}{dtype} \PY{o}{==} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{object}\PY{l+s+s2}{\PYZdq{}} \PY{k}{else} \PY{n}{x}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{5}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Printing the first 5 rows of the data}
\PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{5}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
  SUBJECT\_ID    AFP     AG Age   ALB ALP ALT AST BASO\# BASO\%  {\ldots}   NEU   PCT
PDW  PHOS  PLT   RBC   RDW  TBIL    TP     UA
0          1   3.58  19.36  47  45.4  56  11  24  0.01   0.3  {\ldots}  76.2  0.09
13.4  1.46   74  2.64  13.7   5.5  73.9  396.4
1          2  34.24  23.98  61  39.9  95   9  13  0.02   0.3  {\ldots}  76.5   0.3
11.2  1.09  304  4.89  12.7   6.8    72  119.2
2          3   1.50   18.4  39  45.4  77   9  18  0.03   0.6  {\ldots}  69.7  0.13
15.2  0.97  112  4.62    12  14.8  77.9  209.2
3          4   2.75   16.6  45  39.2  26  16  17  0.05  0.74  {\ldots}  65.5  0.25
17.4  1.25  339  4.01  14.6  10.9  66.1  215.6
4          5   2.36  19.97  45    35  47  21  27  0.01   0.1  {\ldots}  59.5  0.28
11.9  0.94  272   4.4  13.4   5.3  66.5    206

[5 rows x 51 columns]
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{6}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Printing the summary statistics of each feature/column in the data}
\PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{describe}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{T}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{6}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
           count unique     top freq
SUBJECT\_ID   349    349     414    1
AFP          327    237    0.61    5
AG           348    307   18.58    3
Age          349     62      45   11
ALB          339    172    42.6    8
ALP          339     97      71   11
ALT          339     46      16   30
AST          339     42      13   31
BASO\#        349     12    0.02   75
BASO\%        349     75     0.2   48
BUN          349    246     3.8    5
Ca           349     84     2.5   13
CA125        332    326    1319    2
CA19-9       325    300  <0.600    6
CA72-4       109    100     0.2    5
CEA          327    207    1.11    5
CL           349    117    99.3   11
CO2CP        348    104    24.6   12
CREA         349    146      56   14
TYPE         349      2       1  178
DBIL         339     60     2.5   23
EO\#          349     32       0   39
EO\%          349    108       0   23
GGT          339     58      12   28
GLO          339    150    32.1    8
GLU.         349    203     4.5    5
HCT          349    148   0.386    8
HE4          329    321   219.1    2
HGB          349     92     123   17
IBIL         339    100     5.4   12
K            349    131     4.3   10
LYM\#         349    172    1.69    6
LYM\%         349    243    30.4    5
MCH          349    107    30.5   14
MCV          349    162    91.5    7
Menopause    349      2       0  230
Mg           349     61       1   22
MONO\#        349     68    0.36   17
MONO\%        349    143     5.1   16
MPV          347    135    10.9   16
Na           349    107   138.6    8
NEU          258    202    65.5    4
PCT          347    113    0.23   22
PDW          347    121    17.4    8
PHOS         349     82     1.2   10
PLT          349    195     247    6
RBC          349    148    4.24    8
RDW          349     84    13.2   18
TBIL         339    125     5.7    8
TP           339    182      77    7
UA           349    326   229.2    3
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{7}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Printing the shape of the data}
\PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{shape}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{7}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(349, 51)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{8}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Printing the concise summary of the data}
\PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{info}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 349 entries, 0 to 348
Data columns (total 51 columns):
 \#   Column      Non-Null Count  Dtype
---  ------      --------------  -----
 0   SUBJECT\_ID  349 non-null    object
 1   AFP         327 non-null    object
 2   AG          348 non-null    object
 3   Age         349 non-null    object
 4   ALB         339 non-null    object
 5   ALP         339 non-null    object
 6   ALT         339 non-null    object
 7   AST         339 non-null    object
 8   BASO\#       349 non-null    object
 9   BASO\%       349 non-null    object
 10  BUN         349 non-null    object
 11  Ca          349 non-null    object
 12  CA125       332 non-null    object
 13  CA19-9      325 non-null    object
 14  CA72-4      109 non-null    object
 15  CEA         327 non-null    object
 16  CL          349 non-null    object
 17  CO2CP       348 non-null    object
 18  CREA        349 non-null    object
 19  TYPE        349 non-null    object
 20  DBIL        339 non-null    object
 21  EO\#         349 non-null    object
 22  EO\%         349 non-null    object
 23  GGT         339 non-null    object
 24  GLO         339 non-null    object
 25  GLU.        349 non-null    object
 26  HCT         349 non-null    object
 27  HE4         329 non-null    object
 28  HGB         349 non-null    object
 29  IBIL        339 non-null    object
 30  K           349 non-null    object
 31  LYM\#        349 non-null    object
 32  LYM\%        349 non-null    object
 33  MCH         349 non-null    object
 34  MCV         349 non-null    object
 35  Menopause   349 non-null    object
 36  Mg          349 non-null    object
 37  MONO\#       349 non-null    object
 38  MONO\%       349 non-null    object
 39  MPV         347 non-null    object
 40  Na          349 non-null    object
 41  NEU         258 non-null    object
 42  PCT         347 non-null    object
 43  PDW         347 non-null    object
 44  PHOS        349 non-null    object
 45  PLT         349 non-null    object
 46  RBC         349 non-null    object
 47  RDW         349 non-null    object
 48  TBIL        339 non-null    object
 49  TP          339 non-null    object
 50  UA          349 non-null    object
dtypes: object(51)
memory usage: 139.2+ KB
    \end{Verbatim}

    \subsubsection{\texorpdfstring{Data Wrangling
}{Data Wrangling }}\label{data-wrangling}

This section of the code is responsible for preparing the dataset for
analysis by cleaning, transforming, and restructuring the data into a
usable format. This section involves handling missing data, dealing with
outliers, and transforming variables to ensure they meet the assumptions
of the analysis method. The goal is to create a reliable dataset that
maximizes accuracy when using machine learning algorithms. Data
wrangling is a critical step in the data analysis process, as the
accuracy of the results depends heavily on the quality of the dataset
used.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{9}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Before converting column types, the column values should be handled for data inconsistency}
\PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AFP}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZgt{}1210.00}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AFP}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{1210.00}\PY{l+s+s1}{\PYZsq{}}
\PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AFP}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZgt{}1210}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AFP}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{1210.00}\PY{l+s+s1}{\PYZsq{}}
\PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CA125}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZgt{}5000.00}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CA125}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{5000.00}\PY{l+s+s1}{\PYZsq{}}
\PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CA19\PYZhy{}9}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZgt{}1000.00}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CA19\PYZhy{}9}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{1000.00}\PY{l+s+s1}{\PYZsq{}}
\PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CA19\PYZhy{}9}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZgt{}1000}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CA19\PYZhy{}9}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{1000.00}\PY{l+s+s1}{\PYZsq{}}
\PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CA19\PYZhy{}9}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZlt{}0.600}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CA19\PYZhy{}9}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{0.5}\PY{l+s+s1}{\PYZsq{}}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{10}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Convert object columns to float columns}
\PY{k}{for} \PY{n}{col} \PY{o+ow}{in} \PY{p}{(}
    \PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{TYPE}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SUBJECT\PYZus{}ID}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{p}{]}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
    \PY{o}{.}\PY{n}{select\PYZus{}dtypes}\PY{p}{(}\PY{n}{include}\PY{o}{=}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{object}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}
    \PY{o}{.}\PY{n}{columns}
\PY{p}{)}\PY{p}{:}
    \PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{n}{col}\PY{p}{]} \PY{o}{=} \PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{n}{col}\PY{p}{]}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Convert target column to integer}
\PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TYPE}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TYPE}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{int64}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{11}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Computing the ratio of missing data in each column}
\PY{n}{missing\PYZus{}ratio} \PY{o}{=} \PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{isnull}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Displaying the ratio of missing data in each column}
\PY{n}{missing\PYZus{}ratio}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{11}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
SUBJECT\_ID      0
AFP            22
AG              1
Age             0
ALB            10
ALP            10
ALT            10
AST            10
BASO\#           0
BASO\%           0
BUN             0
Ca              0
CA125          17
CA19-9         24
CA72-4        240
CEA            22
CL              0
CO2CP           1
CREA            0
TYPE            0
DBIL           10
EO\#             0
EO\%             0
GGT            10
GLO            10
GLU.            0
HCT             0
HE4            20
HGB             0
IBIL           10
K               0
LYM\#            0
LYM\%            0
MCH             0
MCV             0
Menopause       0
Mg              0
MONO\#           0
MONO\%           0
MPV             2
Na              0
NEU            91
PCT             2
PDW             2
PHOS            0
PLT             0
RBC             0
RDW             0
TBIL           10
TP             10
UA              0
dtype: int64
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{12}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Computing the ratio of missing data in each column}
\PY{n}{missing\PYZus{}ratio} \PY{o}{=} \PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{isnull}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Displaying the ratio of missing data in each column}
\PY{n}{missing\PYZus{}ratio}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{12}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
SUBJECT\_ID    0.000000
AFP           0.063037
AG            0.002865
Age           0.000000
ALB           0.028653
ALP           0.028653
ALT           0.028653
AST           0.028653
BASO\#         0.000000
BASO\%         0.000000
BUN           0.000000
Ca            0.000000
CA125         0.048711
CA19-9        0.068768
CA72-4        0.687679
CEA           0.063037
CL            0.000000
CO2CP         0.002865
CREA          0.000000
TYPE          0.000000
DBIL          0.028653
EO\#           0.000000
EO\%           0.000000
GGT           0.028653
GLO           0.028653
GLU.          0.000000
HCT           0.000000
HE4           0.057307
HGB           0.000000
IBIL          0.028653
K             0.000000
LYM\#          0.000000
LYM\%          0.000000
MCH           0.000000
MCV           0.000000
Menopause     0.000000
Mg            0.000000
MONO\#         0.000000
MONO\%         0.000000
MPV           0.005731
Na            0.000000
NEU           0.260745
PCT           0.005731
PDW           0.005731
PHOS          0.000000
PLT           0.000000
RBC           0.000000
RDW           0.000000
TBIL          0.028653
TP            0.028653
UA            0.000000
dtype: float64
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{13}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Before handling missing data, let\PYZsq{}s put the missing data in another variable to perform analysis later}
\PY{n}{df\PYZus{}cancer\PYZus{}missing} \PY{o}{=} \PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Dropping columns with a missing data ratio greater than 0.5}
\PY{n}{cols\PYZus{}to\PYZus{}drop} \PY{o}{=} \PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{CA72\PYZhy{}4}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{CA19\PYZhy{}9}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AFP}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{CEA}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{HE4}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SUBJECT\PYZus{}ID}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}
\PY{n}{df\PYZus{}cancer} \PY{o}{=} \PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{n}{cols\PYZus{}to\PYZus{}drop}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}

\PY{c+c1}{\PYZsh{} get columns with missing data}
\PY{n}{cols\PYZus{}with\PYZus{}missing} \PY{o}{=} \PY{p}{[}\PY{n}{col} \PY{k}{for} \PY{n}{col} \PY{o+ow}{in} \PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{columns} \PY{k}{if} \PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{n}{col}\PY{p}{]}\PY{o}{.}\PY{n}{isnull}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{any}\PY{p}{(}\PY{p}{)}\PY{p}{]}

\PY{c+c1}{\PYZsh{} impute missing data with the median value}
\PY{k}{for} \PY{n}{col} \PY{o+ow}{in} \PY{n}{cols\PYZus{}with\PYZus{}missing}\PY{p}{:}
    \PY{n}{median\PYZus{}val} \PY{o}{=} \PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{n}{col}\PY{p}{]}\PY{o}{.}\PY{n}{median}\PY{p}{(}\PY{p}{)}
    \PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{n}{col}\PY{p}{]}\PY{o}{.}\PY{n}{fillna}\PY{p}{(}\PY{n}{median\PYZus{}val}\PY{p}{,} \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Displaying the updated missing data ratio}
\PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{isnull}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{13}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
AG           0.0
Age          0.0
ALB          0.0
ALP          0.0
ALT          0.0
AST          0.0
BASO\#        0.0
BASO\%        0.0
BUN          0.0
Ca           0.0
CA125        0.0
CL           0.0
CO2CP        0.0
CREA         0.0
TYPE         0.0
DBIL         0.0
EO\#          0.0
EO\%          0.0
GGT          0.0
GLO          0.0
GLU.         0.0
HCT          0.0
HGB          0.0
IBIL         0.0
K            0.0
LYM\#         0.0
LYM\%         0.0
MCH          0.0
MCV          0.0
Menopause    0.0
Mg           0.0
MONO\#        0.0
MONO\%        0.0
MPV          0.0
Na           0.0
NEU          0.0
PCT          0.0
PDW          0.0
PHOS         0.0
PLT          0.0
RBC          0.0
RDW          0.0
TBIL         0.0
TP           0.0
UA           0.0
dtype: float64
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{14}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate the ratio of missing values in each column}
\PY{n}{missing\PYZus{}ratio} \PY{o}{=} \PY{n}{df\PYZus{}cancer\PYZus{}missing}\PY{o}{.}\PY{n}{isnull}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)} \PY{o}{/} \PY{n+nb}{len}\PY{p}{(}\PY{n}{df\PYZus{}cancer\PYZus{}missing}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Filter columns with missing values}
\PY{n}{missing\PYZus{}ratio} \PY{o}{=} \PY{n}{missing\PYZus{}ratio}\PY{p}{[}\PY{n}{missing\PYZus{}ratio} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{]}

\PY{c+c1}{\PYZsh{} Create the bar chart using Plotly}
\PY{n}{fig} \PY{o}{=} \PY{n}{px}\PY{o}{.}\PY{n}{bar}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{n}{missing\PYZus{}ratio}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{n}{missing\PYZus{}ratio}\PY{o}{.}\PY{n}{values}\PY{p}{,} \PY{n}{text\PYZus{}auto}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{n}{missing\PYZus{}ratio}\PY{o}{.}\PY{n}{index}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update the layout of the plot}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ratio of missing values in columns with missing values}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{xaxis\PYZus{}title}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Column name}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yaxis\PYZus{}title}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ratio of missing values}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}/charts/Ratio of missing values in columns with missing values.png\PYZdq{}, engine=\PYZdq{}kaleido\PYZdq{})}

\PY{c+c1}{\PYZsh{} Show the plot}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    
    
    Of all the feature variables, Carbohydrate antigen 72-4 (CA72-4) had
\textasciitilde69\% missing observations, Neutrophil ratio (NEU) had
26\%, and Carbohydrate antigen 19-9 (\textasciitilde7\%) being the top 3
features with the highest percentage of missing observations.

    \subsubsection{\texorpdfstring{Feature Engineering
}{Feature Engineering }}\label{feature-engineering}

This section of the code refers to the process of selecting and
transforming the relevant features of the data to create new features
that better represent the problem domain.The purpose of feature
engineering is to improve the performance of machine learning algorithms
by reducing the noise in the data, increasing the accuracy of the
predictions, and making the model more interpretable. It requires a deep
understanding of the problem domain and the data being used, as well as
knowledge of the available feature engineering techniques and their
impact on the model's performance.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{15}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Map the \PYZsq{}TYPE\PYZsq{} column to \PYZdq{}0 \PYZhy{} Benign Ovarian Tumors\PYZdq{} and \PYZsq{}1 \PYZhy{} Ovarian Cancer\PYZsq{}}
\PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Type\PYZus{}Label}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{=} \PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{TYPE}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{map}\PY{p}{(}
    \PY{p}{\PYZob{}}\PY{l+m+mi}{0}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ovarian Cancer}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Benign Ovarian Tumors}\PY{l+s+s2}{\PYZdq{}}\PY{p}{\PYZcb{}}
\PY{p}{)}
\PY{c+c1}{\PYZsh{} Map the \PYZsq{}Menopause\PYZsq{} column to \PYZdq{}0 \PYZhy{} No\PYZdq{} and \PYZsq{}1 \PYZhy{} Yes\PYZsq{}}
\PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Menopause\PYZus{}Label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Menopause}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{map}\PY{p}{(}\PY{p}{\PYZob{}}\PY{l+m+mi}{0}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{No}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Yes}\PY{l+s+s1}{\PYZsq{}}\PY{p}{\PYZcb{}}\PY{p}{)}
\PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{15}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
      AG   Age   ALB   ALP   ALT   AST  BASO\#  BASO\%   BUN    Ca  {\ldots}   PDW
PHOS    PLT   RBC   RDW  TBIL    TP     UA      Type\_Label  \textbackslash{}
0  19.36  47.0  45.4  56.0  11.0  24.0   0.01   0.30  5.35  2.48  {\ldots}  13.4
1.46   74.0  2.64  13.7   5.5  73.9  396.4  Ovarian Cancer
1  23.98  61.0  39.9  95.0   9.0  13.0   0.02   0.30  3.21  2.62  {\ldots}  11.2
1.09  304.0  4.89  12.7   6.8  72.0  119.2  Ovarian Cancer
2  18.40  39.0  45.4  77.0   9.0  18.0   0.03   0.60  3.80  2.57  {\ldots}  15.2
0.97  112.0  4.62  12.0  14.8  77.9  209.2  Ovarian Cancer
3  16.60  45.0  39.2  26.0  16.0  17.0   0.05   0.74  5.27  2.35  {\ldots}  17.4
1.25  339.0  4.01  14.6  10.9  66.1  215.6  Ovarian Cancer
4  19.97  45.0  35.0  47.0  21.0  27.0   0.01   0.10  4.89  2.48  {\ldots}  11.9
0.94  272.0  4.40  13.4   5.3  66.5  206.0  Ovarian Cancer

   Menopause\_Label
0               No
1              Yes
2               No
3              Yes
4               No

[5 rows x 47 columns]
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{16}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} split data into features (X) and target (y)}
\PY{n}{X} \PY{o}{=} \PY{n}{df\PYZus{}cancer}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TYPE}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type\PYZus{}Label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Menopause\PYZus{}Label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{y} \PY{o}{=} \PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TYPE}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{17}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} select top 20 features using MRMR}
\PY{n}{top\PYZus{}features} \PY{o}{=} \PY{n}{mrmr\PYZus{}classif}\PY{p}{(}\PY{n}{X}\PY{o}{=}\PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{n}{y}\PY{p}{,} \PY{n}{K}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:00<00:00,
29.44it/s]
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{18}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{top\PYZus{}features}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{18}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
['Age',
 'IBIL',
 'NEU',
 'Menopause',
 'ALB',
 'CA125',
 'GLO',
 'LYM\%',
 'AST',
 'HGB',
 'PLT',
 'ALP',
 'LYM\#',
 'PCT',
 'Ca',
 'MONO\#',
 'TBIL',
 'GLU.',
 'MCH',
 'Na']
\end{Verbatim}
\end{tcolorbox}
        
    The top 20 features contributing to the target variable (TYPE) are
selected using the mRMR algorithm. The selected features are: 1. Age 2.
Indirect Bilirubin (IBIL) 3. Neutrophil ratio (NEU) 4. Menopause 5.
Albumin (ALB) 6. Carbohydrate antigen 125 (CA125) 7. Globulin (GLO) 8.
Lymphocyte ratio (LYM\%) 9. Aspartate aminotransferase (AST) 10.
Hemoglobin (HGB) 11. Platelet count (PLT) 12. Alkaline phosphate (ALP)
13. Lymphocyte count (LYM\#) 14. Thrombocytocrit (PCT) 15. Calcium (ca)
16. Mononuclear cell count (MONO\#) 17. Total Bilirubin (TBIL) 18.
Glucose (GLU) 19. Mean corpuscular hemoglobin (MCH) 20. Natrium (Na)

    \subsubsection{\texorpdfstring{Preliminary Data Analysis
}{Preliminary Data Analysis }}\label{preliminary-data-analysis}

This section of the code involves an initial examination of the dataset
to understand its structure, contents, and quality. This includes
checking for the extent of missing or erroneous data, exploring the
distribution of the variables, identifying any outliers, and computing
summary statistics. The purpose of this section is to gain insights into
the dataset and inform subsequent data processing steps. It also
involves visualizing the data using various plotting techniques to
reveal patterns or relationships between the variables.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{19}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Visualizing the correlation between the features in the training data}
\PY{n}{selected\PYZus{}cols} \PY{o}{=} \PY{n}{top\PYZus{}features} \PY{o}{+} \PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{TYPE}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}

\PY{c+c1}{\PYZsh{} Selecting the row or column corresponding to the target column}
\PY{n}{target\PYZus{}corr} \PY{o}{=} \PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{n}{selected\PYZus{}cols}\PY{p}{]}\PY{o}{.}\PY{n}{corr}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TYPE}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{target\PYZus{}corr} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{target\PYZus{}corr} \PY{o}{*}\PY{o}{*} \PY{l+m+mi}{2}\PY{p}{)} \PY{c+c1}{\PYZsh{} find the magnitude of each correlation, at this instance, we are only interested in the magnitude}
\PY{c+c1}{\PYZsh{} of each correlation, and not its direction.}

\PY{c+c1}{\PYZsh{} Displaying the correlation values of each feature with the target column in descending order}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Correlation of selected features with target column (sorted in descending order)  }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{target\PYZus{}corr}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Correlation of selected features with target column (sorted in descending order)

    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{19}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
TYPE         1.000000
Age          0.514098
Menopause    0.455770
ALB          0.375415
CA125        0.372262
NEU          0.353062
LYM\%         0.315035
PLT          0.270182
LYM\#         0.256494
PCT          0.243719
AST          0.215888
ALP          0.213249
MONO\#        0.200536
IBIL         0.200451
HGB          0.197863
TBIL         0.195921
GLO          0.195630
Ca           0.187119
GLU.         0.179048
MCH          0.166818
Na           0.143849
Name: TYPE, dtype: float64
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{20}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Create a correlation matrix}
\PY{n}{corr\PYZus{}matrix} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{around}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{n}{selected\PYZus{}cols}\PY{p}{]}\PY{o}{.}\PY{n}{corr}\PY{p}{(}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)} \PY{c+c1}{\PYZsh{} Use the correlation magnitude instead of the direction}

\PY{c+c1}{\PYZsh{} Create the heatmap using Plotly}
\PY{n}{fig} \PY{o}{=} \PY{n}{ff}\PY{o}{.}\PY{n}{create\PYZus{}annotated\PYZus{}heatmap}\PY{p}{(}
    \PY{n}{z}\PY{o}{=}\PY{n}{corr\PYZus{}matrix}\PY{o}{.}\PY{n}{to\PYZus{}numpy}\PY{p}{(}\PY{p}{)}\PY{p}{,}
    \PY{n}{x}\PY{o}{=}\PY{n}{corr\PYZus{}matrix}\PY{o}{.}\PY{n}{columns}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{n}{corr\PYZus{}matrix}\PY{o}{.}\PY{n}{columns}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}\PY{p}{,}
    \PY{n}{annotation\PYZus{}text}\PY{o}{=}\PY{n}{corr\PYZus{}matrix}\PY{o}{.}\PY{n}{to\PYZus{}numpy}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{str}\PY{p}{)}\PY{p}{,}
    \PY{n}{colorscale}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RdBu\PYZus{}r}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}  \PY{c+c1}{\PYZsh{} Using a similar colorscale to \PYZsq{}coolwarm\PYZsq{}}
    \PY{n}{showscale}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update the layout of the plot}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Correlation Heatmap of Top Features}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{1000}\PY{p}{,}
    \PY{n}{xaxis}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{tickangle}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{45}\PY{p}{)}\PY{p}{,}
    \PY{n}{yaxis}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{tickmode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{array}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{tickvals}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{selected\PYZus{}cols}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{,}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{l}\PY{o}{=}\PY{l+m+mi}{200}\PY{p}{,} \PY{n}{r}\PY{o}{=}\PY{l+m+mi}{200}\PY{p}{,} \PY{n}{t}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Show the plot}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    Based on the available data, and the correlation result above, it is
safe to say that women are at a higher risk of developing ovarian cancer
as they age. The top three factors are Age (51\%), Menopause (46\%), and
Albumin (38\%) respectively, with the least three factors being Calcium
(19\%), Carcinoembryonic antigen (17\%), and Carbohydrate antigen 19-9
(15\%).

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{21}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig} \PY{o}{=} \PY{n}{px}\PY{o}{.}\PY{n}{scatter\PYZus{}matrix}\PY{p}{(}
    \PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{n}{top\PYZus{}features}\PY{p}{]}\PY{p}{,}
    \PY{n}{dimensions}\PY{o}{=}\PY{n}{top\PYZus{}features}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{1500}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Scatter Plot Matrix of Selected Features}\PY{l+s+s1}{\PYZsq{}}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{22}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Visualizing the distribution of the target variable in the training data}
\PY{n}{fig} \PY{o}{=} \PY{n}{px}\PY{o}{.}\PY{n}{histogram}\PY{p}{(}\PY{n}{df\PYZus{}cancer}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type\PYZus{}Label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{text\PYZus{}auto}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{orientation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{v}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type\PYZus{}Label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
\PY{n}{xaxis\PYZus{}title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cancer Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
\PY{n}{yaxis\PYZus{}title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Number of Patients}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
\PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Distribution of Target Variable}\PY{l+s+s1}{\PYZsq{}}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    From the above, it can be seen that there is a class balance between the
number of patients with Ovarian cancer (\textbf{\emph{0}}), and patients
with Benign Ovarian Tumors (\textbf{\emph{1}}).

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{23}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Plotting the distribution of cancer types by menopause status}
\PY{n}{fig} \PY{o}{=} \PY{n}{px}\PY{o}{.}\PY{n}{histogram}\PY{p}{(}\PY{n}{df\PYZus{}cancer}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Menopause\PYZus{}Label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type\PYZus{}Label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{barmode}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{group}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{text\PYZus{}auto}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Distribution of Cancer Types by Menopause Status}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
    \PY{n}{yaxis\PYZus{}title} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of Patients}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{xaxis\PYZus{}title} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Menopause}\PY{l+s+s2}{\PYZdq{}}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    Women at the menopause stage have higher records of Ovarian Cancer than
women not at this stage. From the above chart, out of 171 patients with
Ovarian cancer, \textbf{56.14\% (96 patients)} have Ovarian cancer and
are at the menopause stage. In contrast, out of the 178 patients with
Benign Ovarian Tumors, only \textbf{12.92\% (23 patients)} are at the
menopause stage.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{24}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Plotting the distribution of cancer types by menopause status}
\PY{n}{fig} \PY{o}{=} \PY{n}{px}\PY{o}{.}\PY{n}{histogram}\PY{p}{(}\PY{n}{df\PYZus{}cancer}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Age}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type\PYZus{}Label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{barmode}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{group}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{text\PYZus{}auto}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Distribution of Patients}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{ Age by Cancer Type}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yaxis\PYZus{}title} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of Patients}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{xaxis\PYZus{}title} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Cancer Type}\PY{l+s+s2}{\PYZdq{}}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{25}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Filter the data to only include positive values of the \PYZdq{}TYPE\PYZdq{} target column}
\PY{n}{positive\PYZus{}data} \PY{o}{=} \PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{n}{df\PYZus{}cancer}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type\PYZus{}Label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ovarian Cancer}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}

\PY{n}{fig} \PY{o}{=} \PY{n}{px}\PY{o}{.}\PY{n}{histogram}\PY{p}{(}\PY{n}{positive\PYZus{}data}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Age}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{text\PYZus{}auto}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
\PY{n}{xaxis\PYZus{}title}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Age}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
\PY{n}{yaxis\PYZus{}title}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of Patients}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
\PY{n}{title}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Distribution of Positive Patients}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{ Age}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    Women are at more risk of ovarian cancer as they age. From the above
chart, women between the age-range of 45 - 64 have more tendencies of
developing ovarian cancer with 50 - 54 being the most prevalent
age-range, followed by the 60 - 64 age-range.

    \subsubsection{\texorpdfstring{Model Training
}{Model Training }}\label{model-training}

This section of the code involves using machine learning algorithms to
build predictive models for detecting ovarian cancer. This section
includes selecting appropriate algorithms and splitting the data into
training and testing sets, training the models on the training data, and
evaluating their performance on the testing data.

The goal of this section is to identify the most accurate and effective
ensemble learning method(s) for detecting ovarian cancer. Ensemble
learning is a machine learning technique that involves combining
multiple models (called baseline models) to improve the overall
performance and accuracy of predictions.

    \textbf{Base Models Checked:} 1. Logistic Regression

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\item
  SVM
\item
  KNN
\item
  Decision Trees
\end{enumerate}

\textbf{Ensemble Learning Techniques Checked:} 1. Voting

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\item
  Stacking
\item
  Bagging
\item
  Boosting (XGBoost and GBM)
\item
  Stacking of Various Ensemble Learning Techniques
\end{enumerate}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{26}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{model\PYZus{}selection} \PY{k+kn}{import} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{,} \PY{n}{GridSearchCV}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{neighbors} \PY{k+kn}{import} \PY{n}{KNeighborsClassifier}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{linear\PYZus{}model} \PY{k+kn}{import} \PY{n}{LogisticRegression}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{tree} \PY{k+kn}{import} \PY{n}{DecisionTreeClassifier}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{ensemble} \PY{k+kn}{import} \PY{p}{(}
    \PY{n}{GradientBoostingClassifier}\PY{p}{,}
    \PY{n}{VotingClassifier}\PY{p}{,}
    \PY{n}{BaggingClassifier}\PY{p}{,}
    \PY{n}{StackingClassifier}
\PY{p}{)}

\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{svm} \PY{k+kn}{import} \PY{n}{SVC}
\PY{k+kn}{from} \PY{n+nn}{xgboost} \PY{k+kn}{import} \PY{n}{XGBClassifier}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
2024/04/13 09:29:24 INFO mlflow.tracking.fluent: Autologging successfully
enabled for xgboost.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{27}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k+kn}{import} \PY{p}{(}
    \PY{n}{classification\PYZus{}report}\PY{p}{,}
    \PY{n}{confusion\PYZus{}matrix}\PY{p}{,}
    \PY{n}{accuracy\PYZus{}score}\PY{p}{,}
    \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{,}
    \PY{n}{roc\PYZus{}curve}\PY{p}{,}
    \PY{n}{precision\PYZus{}score}\PY{p}{,}
    \PY{n}{auc}\PY{p}{,}
    \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{,}
    \PY{n}{f1\PYZus{}score}\PY{p}{,}
    \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{,}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{28}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Split into training (60\PYZpc{}), testing (30\PYZpc{}), and cross\PYZhy{}validation (10\PYZpc{})}
\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{X\PYZus{}temp}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}temp} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}
    \PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{p}{,} \PY{n}{test\PYZus{}size}\PY{o}{=}\PY{l+m+mf}{0.4}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}
\PY{p}{)}
\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}test} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}
    \PY{n}{X\PYZus{}temp}\PY{p}{,} \PY{n}{y\PYZus{}temp}\PY{p}{,} \PY{n}{test\PYZus{}size}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Select top features after splitting}
\PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{X\PYZus{}train}\PY{p}{[}\PY{n}{top\PYZus{}features}\PY{p}{]}
\PY{n}{X\PYZus{}test} \PY{o}{=} \PY{n}{X\PYZus{}test}\PY{p}{[}\PY{n}{top\PYZus{}features}\PY{p}{]}
\PY{n}{X\PYZus{}cv} \PY{o}{=} \PY{n}{X\PYZus{}cv}\PY{p}{[}\PY{n}{top\PYZus{}features}\PY{p}{]}
\end{Verbatim}
\end{tcolorbox}

    \subsubsection{\texorpdfstring{Analysis of Baseline Algorithms
}{Analysis of Baseline Algorithms }}\label{analysis-of-baseline-algorithms}

This section of the code involves evaluating the performance of the
baseline methods used in the model training section, by using
appropriate evaluation metrics and comparing the results. The purpose is
to determine the most effective and efficient method for detecting
ovarian cancer tumors and to identify the factors that contribute to the
superior performance of a particular baseline algorithm over others.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{29}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{}  Create a dataframe to store the accuracy of baseline models for further analysis}
\PY{n}{basemodel\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}
    \PY{n}{columns}\PY{o}{=}\PY{p}{[}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}
\PY{p}{]}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \paragraph{Logistic regression}\label{logistic-regression}

    \subparagraph{Cross-Validation Set}\label{cross-validation-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{30}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Create a logistic regression classifier}
    \PY{n}{lr\PYZus{}clf\PYZus{}cv} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Fit the model to the training data}
    \PY{n}{lr\PYZus{}clf\PYZus{}cv}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Make predictions on the test data}
    \PY{n}{y\PYZus{}pred\PYZus{}lr\PYZus{}cv} \PY{o}{=} \PY{n}{lr\PYZus{}clf\PYZus{}cv}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Get probabilities for the positive class}
    \PY{n}{y\PYZus{}scores\PYZus{}lr\PYZus{}cv} \PY{o}{=} \PY{n}{lr\PYZus{}clf\PYZus{}cv}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Accuracy}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{lr\PYZus{}clf\PYZus{}cv}\PY{o}{.}\PY{n}{score}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Confusion Matrix}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}lr\PYZus{}cv}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Sensitivity (Recall) and Specificity calculations}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} ROC AUC Score and curve}
    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}lr\PYZus{}cv}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Use scores, not predictions, for AUC}
    \PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{thresholds} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}lr\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Precision}
    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}lr\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} F1\PYZhy{}Score}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}lr\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Append the new results to your DataFrame or storage structure}
    \PY{n}{basemodel\PYZus{}df} \PY{o}{=} \PY{n}{basemodel\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Logistic Regression CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the test set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Logistic Regression CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}lr\PYZus{}cv}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{lr\PYZus{}clf\PYZus{}cv}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Logistic Regression CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{lr\PYZus{}clf\PYZus{}cv}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}Logistic Regression CV\PYZdq{}, ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(lr\PYZus{}clf\PYZus{}cv, \PYZdq{}Logistic Regression CV\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}lr\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{lr\PYZus{}clf\PYZus{}cv}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}logistic\PYZhy{}reg\PYZhy{}cv\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Logistic Regression CV
              precision    recall  f1-score   support

           0       0.90      0.79      0.84        33
           1       0.83      0.92      0.87        37

    accuracy                           0.86        70
   macro avg       0.86      0.85      0.86        70
weighted avg       0.86      0.86      0.86        70


Confusion Matrix:
[[26  7]
 [ 3 34]]
Run ID: f7e865cbd38448b3bc25ad41f81a6eea
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Registered model 'sk-learn-logistic-reg-cv-model' already exists. Creating a new
version of this model{\ldots}
2024/04/13 09:29:39 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-
logistic-reg-cv-model, version 3
Created version '3' of model 'sk-learn-logistic-reg-cv-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{31}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}lr\PYZus{}cv}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}lr\PYZus{}cv}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}lr\PYZus{}cv}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}lr\PYZus{}cv}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (Logistic Regression on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Model Performance (Logistic Regression on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Model Performance (Logistic Regression on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \subparagraph{Testing Set}\label{testing-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{32}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Create a logistic regression classifier}
    \PY{n}{lr\PYZus{}clf} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Fit the model to the training data}
    \PY{n}{lr\PYZus{}clf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Make predictions on the test data}
    \PY{n}{y\PYZus{}pred\PYZus{}lr} \PY{o}{=} \PY{n}{lr\PYZus{}clf}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Get probabilities for the positive class}
    \PY{n}{y\PYZus{}scores\PYZus{}lr} \PY{o}{=} \PY{n}{lr\PYZus{}clf}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Accuracy}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{lr\PYZus{}clf}\PY{o}{.}\PY{n}{score}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}test}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Confusion Matrix}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}lr}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Sensitivity (Recall) and Specificity calculations}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} ROC AUC Score and curve}
    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}lr}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Use scores, not predictions, for AUC}
    \PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{thresholds} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}lr}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Precision}
    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}lr}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} F1\PYZhy{}Score}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}lr}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Append the new results to your DataFrame or storage structure}
    \PY{n}{basemodel\PYZus{}df} \PY{o}{=} \PY{n}{basemodel\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Logistic Regression}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the test set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Logistic Regression}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}lr}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{lr\PYZus{}clf}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Logistic Regression}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{lr\PYZus{}clf}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}Logistic Regression\PYZdq{}, ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(lr\PYZus{}clf, \PYZdq{}Logistic Regression\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}lr}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{lr\PYZus{}clf}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}logistic\PYZhy{}reg\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Logistic Regression
              precision    recall  f1-score   support

           0       0.79      0.66      0.72        35
           1       0.71      0.83      0.76        35

    accuracy                           0.74        70
   macro avg       0.75      0.74      0.74        70
weighted avg       0.75      0.74      0.74        70


Confusion Matrix:
[[23 12]
 [ 6 29]]
Run ID: 9e5797f27fac4e258f727085afeb1399
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Registered model 'sk-learn-logistic-reg-model' already exists. Creating a new
version of this model{\ldots}
2024/04/13 09:29:50 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-
logistic-reg-model, version 3
Created version '3' of model 'sk-learn-logistic-reg-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{33}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}lr}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}lr}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}lr}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}lr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (Logistic Regression): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Model Performance (Logistic Regression Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Model Performance (Logistic Regression Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \paragraph{SVM Classifier}\label{svm-classifier}

    \subparagraph{Cross-Validation Set}\label{cross-validation-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{34}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Training the SVM model}
    \PY{n}{svm\PYZus{}model\PYZus{}cv} \PY{o}{=} \PY{n}{SVC}\PY{p}{(}\PY{n}{kernel}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{linear}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{probability}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Fit the model to the training data}
    \PY{n}{svm\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Make predictions on the test data}
    \PY{n}{y\PYZus{}pred\PYZus{}svm\PYZus{}cv} \PY{o}{=} \PY{n}{svm\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Get probabilities for the positive class}
    \PY{n}{y\PYZus{}scores\PYZus{}svm\PYZus{}cv} \PY{o}{=} \PY{n}{svm\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Accuracy}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{svm\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{score}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Confusion Matrix}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}svm\PYZus{}cv}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Sensitivity (Recall) and Specificity calculations}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} ROC AUC Score and curve}
    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}svm\PYZus{}cv}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Use scores, not predictions, for AUC}
    \PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{thresholds} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}svm\PYZus{}cv}\PY{p}{)}

    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}svm\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} F1\PYZhy{}Score}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}svm\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Append the new results to your DataFrame or storage structure}
    \PY{n}{basemodel\PYZus{}df} \PY{o}{=} \PY{n}{basemodel\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SVM Classifier CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the test set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SVM Classifier CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}svm\PYZus{}cv}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{svm\PYZus{}model\PYZus{}cv}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SVM Classifier CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{svm\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}SVM Classifier CV\PYZdq{}, ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(svm\PYZus{}model\PYZus{}cv, \PYZdq{}SVM Classifier CV\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}svm\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{svm\PYZus{}model\PYZus{}cv}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}svm\PYZhy{}clf\PYZhy{}cv\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
SVM Classifier CV
              precision    recall  f1-score   support

           0       0.92      0.73      0.81        33
           1       0.80      0.95      0.86        37

    accuracy                           0.84        70
   macro avg       0.86      0.84      0.84        70
weighted avg       0.86      0.84      0.84        70


Confusion Matrix:
[[24  9]
 [ 2 35]]
Run ID: 9e63d0f09bb940528ad7328934ede863
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Registered model 'sk-learn-svm-clf-cv-model' already exists. Creating a new
version of this model{\ldots}
2024/04/13 09:30:09 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-svm-
clf-cv-model, version 3
Created version '3' of model 'sk-learn-svm-clf-cv-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{35}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}svm\PYZus{}cv}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}svm\PYZus{}cv}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}svm\PYZus{}cv}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}svm\PYZus{}cv}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (SVM Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust the bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Model Performance (SVM Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Model Performance (SVM Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \subparagraph{Testing Set}\label{testing-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{36}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Training the SVM model}
    \PY{n}{svm\PYZus{}model} \PY{o}{=} \PY{n}{SVC}\PY{p}{(}\PY{n}{kernel}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{linear}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{probability}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Fit the model to the training data}
    \PY{n}{svm\PYZus{}model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Make predictions on the test data}
    \PY{n}{y\PYZus{}pred\PYZus{}svm} \PY{o}{=} \PY{n}{svm\PYZus{}model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Get probabilities for the positive class}
    \PY{n}{y\PYZus{}scores\PYZus{}svm} \PY{o}{=} \PY{n}{svm\PYZus{}model}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Accuracy}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{svm\PYZus{}model}\PY{o}{.}\PY{n}{score}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}test}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Confusion Matrix}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}svm}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Sensitivity (Recall) and Specificity calculations}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} ROC AUC Score and curve}
    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}svm}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Use scores, not predictions, for AUC}
    \PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{thresholds} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}svm}\PY{p}{)}

    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}svm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} F1\PYZhy{}Score}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}svm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Append the new results to your DataFrame or storage structure}
    \PY{n}{basemodel\PYZus{}df} \PY{o}{=} \PY{n}{basemodel\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SVM Classifier}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the test set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SVM Classifier}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}svm}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{svm\PYZus{}model}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SVM Classifier}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{svm\PYZus{}model}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}SVM Classifier\PYZdq{}, ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(svm\PYZus{}model, \PYZdq{}SVM Classifier\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}svm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{svm\PYZus{}model}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}svm\PYZhy{}clf\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
SVM Classifier
              precision    recall  f1-score   support

           0       0.89      0.69      0.77        35
           1       0.74      0.91      0.82        35

    accuracy                           0.80        70
   macro avg       0.82      0.80      0.80        70
weighted avg       0.82      0.80      0.80        70


Confusion Matrix:
[[24 11]
 [ 3 32]]
Run ID: 106063f4b5564203bc5aadc5b055fed5
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Registered model 'sk-learn-svm-clf-model' already exists. Creating a new version
of this model{\ldots}
2024/04/13 09:30:30 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-svm-
clf-model, version 2
Created version '2' of model 'sk-learn-svm-clf-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{37}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}svm}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}svm}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}svm}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}svm}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (SVM Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust the bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Model Performance (SVM Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Model Performance (SVM Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \paragraph{KNN Classifier}\label{knn-classifier}

    \subparagraph{Cross-Validation Set}\label{cross-validation-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{38}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Training the KNN model}
    \PY{n}{knn\PYZus{}model\PYZus{}cv} \PY{o}{=} \PY{n}{KNeighborsClassifier}\PY{p}{(}\PY{n}{n\PYZus{}neighbors}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Fit the model to the training data}
    \PY{n}{knn\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Make predictions on the test data}
    \PY{n}{y\PYZus{}pred\PYZus{}knn\PYZus{}cv} \PY{o}{=} \PY{n}{knn\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Get probabilities for the positive class}
    \PY{n}{y\PYZus{}scores\PYZus{}knn\PYZus{}cv} \PY{o}{=} \PY{n}{knn\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Metrics calculation}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{knn\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{score}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}cv}\PY{p}{)}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}knn\PYZus{}cv}\PY{p}{)}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Recall}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}knn\PYZus{}cv}\PY{p}{)}
    \PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}knn\PYZus{}cv}\PY{p}{)}
    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}knn\PYZus{}cv}\PY{p}{)}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}knn\PYZus{}cv}\PY{p}{)}
    \PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}knn\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Append the new results to your DataFrame}
    \PY{n}{basemodel\PYZus{}df} \PY{o}{=} \PY{n}{basemodel\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{KNN Classifier CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the test set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{KNN Classifier CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}knn\PYZus{}cv}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{knn\PYZus{}model\PYZus{}cv}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{KNN Classifier CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{knn\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}KNN Classifier CV\PYZdq{},  ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(knn\PYZus{}model\PYZus{}cv, \PYZdq{}KNN Classifier CV\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}knn\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{knn\PYZus{}model\PYZus{}cv}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}knn\PYZhy{}clf\PYZhy{}cv\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
KNN Classifier CV
              precision    recall  f1-score   support

           0       0.85      0.70      0.77        33
           1       0.77      0.89      0.82        37

    accuracy                           0.80        70
   macro avg       0.81      0.79      0.80        70
weighted avg       0.81      0.80      0.80        70


Confusion Matrix:
[[23 10]
 [ 4 33]]
Run ID: 79943919b2fa43a2aa68325fcd0cb1ed
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Registered model 'sk-learn-knn-clf-cv-model' already exists. Creating a new
version of this model{\ldots}
2024/04/13 09:30:44 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-knn-
clf-cv-model, version 3
Created version '3' of model 'sk-learn-knn-clf-cv-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{39}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}knn\PYZus{}cv}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}knn\PYZus{}cv}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}knn\PYZus{}cv}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}knn\PYZus{}cv}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (KNN Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Model Performance (KNN Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Model Performance (KNN Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \subparagraph{Testing Set}\label{testing-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{40}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Training the KNN model}
    \PY{n}{knn\PYZus{}model} \PY{o}{=} \PY{n}{KNeighborsClassifier}\PY{p}{(}\PY{n}{n\PYZus{}neighbors}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Fit the model to the training data}
    \PY{n}{knn\PYZus{}model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Make predictions on the test data}
    \PY{n}{y\PYZus{}pred\PYZus{}knn} \PY{o}{=} \PY{n}{knn\PYZus{}model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Get probabilities for the positive class}
    \PY{n}{y\PYZus{}scores\PYZus{}knn} \PY{o}{=} \PY{n}{knn\PYZus{}model}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Metrics calculation}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{knn\PYZus{}model}\PY{o}{.}\PY{n}{score}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}test}\PY{p}{)}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}knn}\PY{p}{)}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Recall}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}
    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}knn}\PY{p}{)}
    \PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}knn}\PY{p}{)}
    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}knn}\PY{p}{)}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}knn}\PY{p}{)}
    \PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}knn}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Append the new results to your DataFrame}
    \PY{n}{basemodel\PYZus{}df} \PY{o}{=} \PY{n}{basemodel\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{KNN Classifier}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the test set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{KNN Classifier}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}knn}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{knn\PYZus{}model}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{KNN Classifier}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{knn\PYZus{}model}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}KNN Classifier\PYZdq{},  ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(knn\PYZus{}model, \PYZdq{}KNN Classifier\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}knn}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{knn\PYZus{}model}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}knn\PYZhy{}clf\PYZhy{}cv\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
KNN Classifier
              precision    recall  f1-score   support

           0       0.74      0.57      0.65        35
           1       0.65      0.80      0.72        35

    accuracy                           0.69        70
   macro avg       0.70      0.69      0.68        70
weighted avg       0.70      0.69      0.68        70


Confusion Matrix:
[[20 15]
 [ 7 28]]
Run ID: 71b6748ef53a4ebb88f50918226d15bc
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Registered model 'sk-learn-knn-clf-cv-model' already exists. Creating a new
version of this model{\ldots}
2024/04/13 09:30:58 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-knn-
clf-cv-model, version 5
Created version '5' of model 'sk-learn-knn-clf-cv-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{41}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}knn}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}knn}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}knn}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}knn}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (KNN Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Model Performance (KNN Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Model Performance (KNN Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \paragraph{Decision Tree Classifier}\label{decision-tree-classifier}

    \subparagraph{Cross-Validation Set}\label{cross-validation-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{42}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Create a random decision tree classifier}
    \PY{n}{dt\PYZus{}clf\PYZus{}cv} \PY{o}{=} \PY{n}{DecisionTreeClassifier}\PY{p}{(}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Fit the model to the training data}
    \PY{n}{dt\PYZus{}clf\PYZus{}cv}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Predict the test data}
    \PY{n}{y\PYZus{}pred\PYZus{}dt\PYZus{}cv} \PY{o}{=} \PY{n}{dt\PYZus{}clf\PYZus{}cv}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Get probabilities for the positive class}
    \PY{n}{y\PYZus{}scores\PYZus{}dt\PYZus{}cv} \PY{o}{=} \PY{n}{dt\PYZus{}clf\PYZus{}cv}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Metrics calculation}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}dt\PYZus{}cv}\PY{p}{)}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}dt\PYZus{}cv}\PY{p}{)}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}dt\PYZus{}cv}\PY{p}{)}
    \PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}dt\PYZus{}cv}\PY{p}{)}
    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}dt\PYZus{}cv}\PY{p}{)}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}dt\PYZus{}cv}\PY{p}{)}
    \PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}dt\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Append the new results to your DataFrame}
    \PY{n}{basemodel\PYZus{}df} \PY{o}{=} \PY{n}{basemodel\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Decision Tree Classifier CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the test set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Decision Tree Classifier CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}dt\PYZus{}cv}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{dt\PYZus{}clf\PYZus{}cv}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Decision Tree Classifier CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{dt\PYZus{}clf\PYZus{}cv}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}Decision Tree Classifier CV\PYZdq{}, ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(dt\PYZus{}clf\PYZus{}cv, \PYZdq{}Decision Tree Classifier CV\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}dt\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{dt\PYZus{}clf\PYZus{}cv}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}decision\PYZhy{}tree\PYZhy{}clf\PYZhy{}cv\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Decision Tree Classifier CV
              precision    recall  f1-score   support

           0       0.81      0.79      0.80        33
           1       0.82      0.84      0.83        37

    accuracy                           0.81        70
   macro avg       0.81      0.81      0.81        70
weighted avg       0.81      0.81      0.81        70


Confusion Matrix:
[[26  7]
 [ 6 31]]
Run ID: ef9126494bb94c63b4dcc1765f0dea37
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Registered model 'sk-learn-decision-tree-clf-cv-model' already exists. Creating
a new version of this model{\ldots}
2024/04/13 09:31:08 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-
decision-tree-clf-cv-model, version 3
Created version '3' of model 'sk-learn-decision-tree-clf-cv-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{43}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}dt\PYZus{}cv}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}dt\PYZus{}cv}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}dt\PYZus{}cv}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}dt\PYZus{}cv}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (Decision Tree Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Model Performance (Decision Tree Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Model Performance (Decision Tree Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \subparagraph{Testing Set}\label{testing-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{44}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Create a random decision tree classifier}
    \PY{n}{dt\PYZus{}clf} \PY{o}{=} \PY{n}{DecisionTreeClassifier}\PY{p}{(}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Fit the model to the training data}
    \PY{n}{dt\PYZus{}clf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Predict on the test data}
    \PY{n}{y\PYZus{}pred\PYZus{}dt} \PY{o}{=} \PY{n}{dt\PYZus{}clf}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Get probabilities for the positive class}
    \PY{n}{y\PYZus{}scores\PYZus{}dt} \PY{o}{=} \PY{n}{dt\PYZus{}clf}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Metrics calculation}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}dt}\PY{p}{)}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}dt}\PY{p}{)}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}dt}\PY{p}{)}
    \PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}dt}\PY{p}{)}
    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}dt}\PY{p}{)}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}dt}\PY{p}{)}
    \PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}dt}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Append the new results to your DataFrame}
    \PY{n}{basemodel\PYZus{}df} \PY{o}{=} \PY{n}{basemodel\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Decision Tree Classifier}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the test set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Decision Tree Classifier}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}dt}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{dt\PYZus{}clf}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Decision Tree Classifier}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{dt\PYZus{}clf}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}Decision Tree Classifier\PYZdq{}, ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(dt\PYZus{}clf, \PYZdq{}Decision Tree Classifier\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}dt\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{dt\PYZus{}clf}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}decision\PYZhy{}tree\PYZhy{}clf\PYZhy{}cv\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Decision Tree Classifier
              precision    recall  f1-score   support

           0       0.92      0.69      0.79        35
           1       0.75      0.94      0.84        35

    accuracy                           0.81        70
   macro avg       0.84      0.81      0.81        70
weighted avg       0.84      0.81      0.81        70


Confusion Matrix:
[[24 11]
 [ 2 33]]
Run ID: 2bf90f60b1164e30a0b289a35d92a9aa
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Registered model 'sk-learn-decision-tree-clf-cv-model' already exists. Creating
a new version of this model{\ldots}
2024/04/13 09:31:20 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-
decision-tree-clf-cv-model, version 5
Created version '5' of model 'sk-learn-decision-tree-clf-cv-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{45}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}dt}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}dt}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}dt}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}dt}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (Decision Tree Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Model Performance (Decision Tree Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Model Performance (Decision Tree Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \subparagraph{Evaluation Metrics
Comparison}\label{evaluation-metrics-comparison}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{46}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{basemodel\PYZus{}df}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{46}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
                Baseline Model  Accuracy  Sensitivity  Specificity  False
Positive Rate  Precision  F1-Score  AUC Score
0       Logistic Regression CV  0.857143     0.918919     0.787879
0.212121   0.829268  0.871795   0.935299
6  Decision Tree Classifier CV  0.814286     0.837838     0.787879
0.212121   0.815789  0.826667   0.812858
2            SVM Classifier CV  0.842857     0.945946     0.727273
0.272727   0.795455  0.864198   0.921376
4            KNN Classifier CV  0.800000     0.891892     0.696970
0.303030   0.767442  0.825000   0.848075
7     Decision Tree Classifier  0.814286     0.942857     0.685714
0.314286   0.750000  0.835443   0.814286
3               SVM Classifier  0.800000     0.914286     0.685714
0.314286   0.744186  0.820513   0.823673
1          Logistic Regression  0.742857     0.828571     0.657143
0.342857   0.707317  0.763158   0.816327
5               KNN Classifier  0.685714     0.800000     0.571429
0.428571   0.651163  0.717949   0.713878
\end{Verbatim}
\end{tcolorbox}
        
    The \textbf{\emph{Logistic Regression algorithm}} provided the best
performance among the four (4) baseline models in terms of all
evaluation metrics used.

    \paragraph{Performance Metrics of Baseline
Models}\label{performance-metrics-of-baseline-models}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{47}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Define a list of colors for the baseline models}
\PY{n}{colors} \PY{o}{=} \PY{p}{[}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rgba(255, 99, 132, 0.6)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rgba(54, 162, 235, 0.6)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rgba(255, 206, 86, 0.6)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rgba(75, 192, 192, 0.6)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rgba(153, 102, 255, 0.6)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rgba(255, 159, 64, 0.6)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
\PY{p}{]}

\PY{c+c1}{\PYZsh{} Map each ensemble model to a specific color}
\PY{n}{unique\PYZus{}models} \PY{o}{=} \PY{n}{basemodel\PYZus{}df}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{p}{)}
\PY{n}{color\PYZus{}map} \PY{o}{=} \PY{p}{\PYZob{}}\PY{n}{model}\PY{p}{:} \PY{n}{colors}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZpc{}} \PY{n+nb}{len}\PY{p}{(}\PY{n}{colors}\PY{p}{)}\PY{p}{]} \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{model} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{unique\PYZus{}models}\PY{p}{)}\PY{p}{\PYZcb{}}

\PY{c+c1}{\PYZsh{} Create Subplots for the model performance using the 6 evaluation metrics}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{,}
    \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
    \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy vs. Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity vs. Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity vs. Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate vs. Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision vs. Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score vs. Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score vs. Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{horizontal\PYZus{}spacing}\PY{o}{=}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{vertical\PYZus{}spacing}\PY{o}{=}\PY{l+m+mf}{0.15}\PY{p}{,}
\PY{p}{)}

\PY{n}{metrics} \PY{o}{=} \PY{p}{[}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
\PY{p}{]}
\PY{n}{plot\PYZus{}positions} \PY{o}{=} \PY{p}{[}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{]}

\PY{k}{for} \PY{n}{metric}\PY{p}{,} \PY{n}{pos} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{metrics}\PY{p}{,} \PY{n}{plot\PYZus{}positions}\PY{p}{)}\PY{p}{:}
    \PY{c+c1}{\PYZsh{} Sort the DataFrame based on the current metric in descending order}
    \PY{n}{df\PYZus{}sorted} \PY{o}{=} \PY{n}{basemodel\PYZus{}df}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{n}{by}\PY{o}{=}\PY{n}{metric}\PY{p}{,} \PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Extracting the sorted model names for consistent color mapping}
    \PY{n}{sorted\PYZus{}models} \PY{o}{=} \PY{n}{df\PYZus{}sorted}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Generate one bar for each model, now in sorted order}
    \PY{k}{for} \PY{n}{model} \PY{o+ow}{in} \PY{n}{sorted\PYZus{}models}\PY{p}{:}
        \PY{n}{df\PYZus{}filtered} \PY{o}{=} \PY{n}{df\PYZus{}sorted}\PY{p}{[}\PY{n}{df\PYZus{}sorted}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Baseline Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{==} \PY{n}{model}\PY{p}{]}
        \PY{n}{show\PYZus{}legend} \PY{o}{=} \PY{p}{(}
            \PY{n}{metric} \PY{o}{==} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}
        \PY{p}{)}  \PY{c+c1}{\PYZsh{} Show legend only in the first subplot for clarity}
        \PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
            \PY{n}{go}\PY{o}{.}\PY{n}{Bar}\PY{p}{(}
                \PY{n}{x}\PY{o}{=}\PY{p}{[}\PY{n}{model}\PY{p}{]}\PY{p}{,}
                \PY{n}{y}\PY{o}{=}\PY{n}{df\PYZus{}filtered}\PY{p}{[}\PY{n}{metric}\PY{p}{]}\PY{p}{,}
                \PY{n}{name}\PY{o}{=}\PY{n}{model}\PY{p}{,}
                \PY{n}{marker\PYZus{}color}\PY{o}{=}\PY{n}{color\PYZus{}map}\PY{p}{[}\PY{n}{model}\PY{p}{]}\PY{p}{,}
                \PY{n}{text}\PY{o}{=}\PY{n}{df\PYZus{}filtered}\PY{p}{[}\PY{n}{metric}\PY{p}{]}\PY{o}{.}\PY{n}{round}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,}
                \PY{n}{textposition}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{outside}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
                \PY{n}{showlegend}\PY{o}{=}\PY{n}{show\PYZus{}legend}\PY{p}{,}
            \PY{p}{)}\PY{p}{,}
            \PY{n}{row}\PY{o}{=}\PY{n}{pos}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}
            \PY{n}{col}\PY{o}{=}\PY{n}{pos}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
        \PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{1500}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1100}\PY{p}{,}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Performance Metrics of Baseline Models}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showlegend}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{n}{legend}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{orientation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{v}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.05}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{)}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{tickangle}\PY{o}{=}\PY{l+m+mi}{45}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n+nb}{range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Performance Metrics of Baseline Models.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Baseline\PYZus{}Models/Performance Metrics of Baseline Models.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display plot}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    The \textbf{\emph{Logistic Regression algorithm}} provided the best
performance among the four baseline models in terms of all evaluation
metrics used. The evaluation metrics used for comparison were
\textbf{\emph{Accuracy, Sensitivity, Specificity, Precision, F1-Score}},
and \textbf{\emph{AUC Score}} respectively.

    \subsubsection{\texorpdfstring{Analysis of Ensemble Methods
}{Analysis of Ensemble Methods }}\label{analysis-of-ensemble-methods}

This section of the code involves evaluating the performance of the
ensemble learning methods used in the model training section, by using
appropriate evaluation metrics and comparing the results. The purpose is
to determine the most effective and efficient method for detecting
ovarian cancer tumors and to identify the factors that contribute to the
superior performance of a particular ensemble learning technique over
others.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{48}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{}  Create a dataframe to store the accuracy of ensemble models for further analysis}
\PY{n}{ensemble\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}
    \PY{n}{columns}\PY{o}{=}\PY{p}{[}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{]}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \paragraph{Voting Classifier}\label{voting-classifier}

    \subparagraph{Cross-Validation Set}\label{cross-validation-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{49}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Making the final model using a voting classifier with soft voting}
    \PY{n}{vote\PYZus{}model\PYZus{}soft\PYZus{}cv} \PY{o}{=} \PY{n}{VotingClassifier}\PY{p}{(}
        \PY{n}{estimators}\PY{o}{=}\PY{p}{[}
            \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{logistic regression CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{lr\PYZus{}clf\PYZus{}cv}\PY{p}{)}\PY{p}{,}
            \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{svc CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{svm\PYZus{}model\PYZus{}cv}\PY{p}{)}\PY{p}{,}  \PY{c+c1}{\PYZsh{} Make sure svm\PYZus{}model is trained with probabilities}
            \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{knn CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{knn\PYZus{}model\PYZus{}cv}\PY{p}{)}\PY{p}{,}
            \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{decision tree CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{dt\PYZus{}clf\PYZus{}cv}\PY{p}{)}\PY{p}{,}
        \PY{p}{]}\PY{p}{,}
        \PY{n}{voting}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{soft}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Training the model on the training dataset}
    \PY{n}{vote\PYZus{}model\PYZus{}soft\PYZus{}cv}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Predicting the output on the test dataset}
    \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}vm\PYZus{}soft\PYZus{}cv} \PY{o}{=} \PY{n}{vote\PYZus{}model\PYZus{}soft\PYZus{}cv}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Get probabilities for the positive class for AUC calculation}
    \PY{n}{y\PYZus{}scores\PYZus{}vm\PYZus{}soft\PYZus{}cv} \PY{o}{=} \PY{n}{vote\PYZus{}model\PYZus{}soft\PYZus{}cv}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Metrics calculation}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}vm\PYZus{}soft\PYZus{}cv}\PY{p}{)}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}vm\PYZus{}soft\PYZus{}cv}\PY{p}{)}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}
    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}vm\PYZus{}soft\PYZus{}cv}\PY{p}{)}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}vm\PYZus{}soft\PYZus{}cv}\PY{p}{)}
    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}vm\PYZus{}soft\PYZus{}cv}\PY{p}{)}
    \PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}vm\PYZus{}soft\PYZus{}cv}\PY{p}{)}

    \PY{n}{ensemble\PYZus{}df} \PY{o}{=} \PY{n}{ensemble\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Voting Classifier (Soft) CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the test set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Voting Classifier Model (Soft Voting) CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}vm\PYZus{}soft\PYZus{}cv}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{vote\PYZus{}model\PYZus{}soft\PYZus{}cv}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Voting Classifier Model (Soft Voting) Regression CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{vote\PYZus{}model\PYZus{}soft\PYZus{}cv}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}Voting Classifier Model (Soft Voting) CV\PYZdq{}, ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(vote\PYZus{}model\PYZus{}soft\PYZus{}cv, \PYZdq{}Voting Classifier Model (Soft Voting) CV\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}vm\PYZus{}soft\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{vote\PYZus{}model\PYZus{}soft\PYZus{}cv}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}svm\PYZhy{}clf\PYZhy{}cv\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Voting Classifier Model (Soft Voting) CV
              precision    recall  f1-score   support

           0       0.93      0.82      0.87        33
           1       0.85      0.95      0.90        37

    accuracy                           0.89        70
   macro avg       0.89      0.88      0.88        70
weighted avg       0.89      0.89      0.88        70


Confusion Matrix:
[[27  6]
 [ 2 35]]
Run ID: bbee2cbcae744398981918b4ec9d9666
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Registered model 'sk-learn-svm-clf-cv-model' already exists. Creating a new
version of this model{\ldots}
2024/04/13 09:31:35 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-svm-
clf-cv-model, version 5
Created version '5' of model 'sk-learn-svm-clf-cv-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{50}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}vm\PYZus{}soft\PYZus{}cv}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}vm\PYZus{}soft\PYZus{}cv}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}vm\PYZus{}soft\PYZus{}cv}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}vm\PYZus{}soft\PYZus{}cv}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (Voting Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Voting Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Voting Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \subparagraph{Testing Set}\label{testing-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{51}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Making the final model using a voting classifier with soft voting}
    \PY{n}{vote\PYZus{}model\PYZus{}soft} \PY{o}{=} \PY{n}{VotingClassifier}\PY{p}{(}
        \PY{n}{estimators}\PY{o}{=}\PY{p}{[}
            \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{logistic regression}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{lr\PYZus{}clf}\PY{p}{)}\PY{p}{,}
            \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{svc}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{svm\PYZus{}model}\PY{p}{)}\PY{p}{,}  \PY{c+c1}{\PYZsh{} Make sure svm\PYZus{}model is trained with probabilities}
            \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{knn}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{knn\PYZus{}model}\PY{p}{)}\PY{p}{,}
            \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{decision tree}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{dt\PYZus{}clf}\PY{p}{)}\PY{p}{,}
        \PY{p}{]}\PY{p}{,}
        \PY{n}{voting}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{soft}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Training the model on the training dataset}
    \PY{n}{vote\PYZus{}model\PYZus{}soft}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Predicting the output on the test dataset}
    \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}vm\PYZus{}soft} \PY{o}{=} \PY{n}{vote\PYZus{}model\PYZus{}soft}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Get probabilities for the positive class for AUC calculation}
    \PY{n}{y\PYZus{}scores\PYZus{}vm\PYZus{}soft} \PY{o}{=} \PY{n}{vote\PYZus{}model\PYZus{}soft}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Metrics calculation}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}vm\PYZus{}soft}\PY{p}{)}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}vm\PYZus{}soft}\PY{p}{)}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}vm\PYZus{}soft}\PY{p}{)}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}vm\PYZus{}soft}\PY{p}{)}
    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}vm\PYZus{}soft}\PY{p}{)}
    \PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}vm\PYZus{}soft}\PY{p}{)}

    \PY{n}{ensemble\PYZus{}df} \PY{o}{=} \PY{n}{ensemble\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Voting Classifier (Soft)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the test set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Voting Classifier Model (Soft Voting)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}vm\PYZus{}soft}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{vote\PYZus{}model\PYZus{}soft}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Voting Classifier Model (Soft Voting) CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{vote\PYZus{}model\PYZus{}soft}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}Voting Classifier Model (Soft Voting) CV\PYZdq{},  ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(vote\PYZus{}model\PYZus{}soft, \PYZdq{}Voting Classifier Model (Soft Voting) CV\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}vm\PYZus{}soft}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{vote\PYZus{}model\PYZus{}soft}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}voting\PYZhy{}clf\PYZhy{}cv\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Voting Classifier Model (Soft Voting)
              precision    recall  f1-score   support

           0       0.91      0.60      0.72        35
           1       0.70      0.94      0.80        35

    accuracy                           0.77        70
   macro avg       0.81      0.77      0.76        70
weighted avg       0.81      0.77      0.76        70


Confusion Matrix:
[[21 14]
 [ 2 33]]
Run ID: b6d4b2ce874248ffad8aa7f09b318be4
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Registered model 'sk-learn-voting-clf-cv-model' already exists. Creating a new
version of this model{\ldots}
2024/04/13 09:31:55 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-
voting-clf-cv-model, version 2
Created version '2' of model 'sk-learn-voting-clf-cv-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{52}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}vm\PYZus{}soft}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}vm\PYZus{}soft}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}vm\PYZus{}soft}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}vm\PYZus{}soft}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (Voting Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Voting Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Voting Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \paragraph{Bagging Classifier}\label{bagging-classifier}

    \subparagraph{Cross-Validation Set}\label{cross-validation-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{53}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Initializing the bagging model using SVM as the base model with default parameters}
    \PY{n}{bag\PYZus{}model\PYZus{}cv} \PY{o}{=} \PY{n}{BaggingClassifier}\PY{p}{(}
        \PY{n}{svm\PYZus{}model}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{,} \PY{n}{n\PYZus{}estimators}\PY{o}{=}\PY{l+m+mi}{10}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Training the model}
    \PY{n}{bag\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Predicting the output on the test dataset}
    \PY{n}{y\PYZus{}pred\PYZus{}bm\PYZus{}cv} \PY{o}{=} \PY{n}{bag\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Calculate metrics}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}bm\PYZus{}cv}\PY{p}{)}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}bm\PYZus{}cv}\PY{p}{)}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Recall}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}bm\PYZus{}cv}\PY{p}{)}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}bm\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Attempt to calculate the ROC AUC Score if probabilities can be estimated}
    \PY{k}{try}\PY{p}{:}
        \PY{n}{y\PYZus{}scores\PYZus{}bm\PYZus{}cv} \PY{o}{=} \PY{n}{bag\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
        \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}bm\PYZus{}cv}\PY{p}{)}
    \PY{k}{except} \PY{n+ne}{AttributeError} \PY{k}{as} \PY{n}{e}\PY{p}{:}
        \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{l+m+mf}{0.00}
        \PY{n+nb}{print}\PY{p}{(}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC AUC Score is not applicable for this configuration without predict\PYZus{}proba:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{n}{e}\PY{p}{,}
        \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Update ensemble\PYZus{}df DataFrame}
    \PY{n}{ensemble\PYZus{}df} \PY{o}{=} \PY{n}{ensemble\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Bagging Classifier with SVM CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the validation set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Bagging Classifier with SVM CV: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}bm\PYZus{}cv}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{bag\PYZus{}model\PYZus{}cv}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Bagging Classifier with SVM CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{bag\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}Bagging Classifier with SVM CV\PYZdq{}, ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(bag\PYZus{}model\PYZus{}cv, \PYZdq{}Bagging Classifier with SVM CV\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}bm\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{bag\PYZus{}model\PYZus{}cv}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}bagging\PYZhy{}clf\PYZhy{}cv\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Bagging Classifier with SVM CV:
              precision    recall  f1-score   support

           0       0.92      0.70      0.79        33
           1       0.78      0.95      0.85        37

    accuracy                           0.83        70
   macro avg       0.85      0.82      0.82        70
weighted avg       0.84      0.83      0.83        70

Confusion Matrix:
[[23 10]
 [ 2 35]]
Run ID: cb0acfab5d374a22927a715233fd9100
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Successfully registered model 'sk-learn-bagging-clf-cv-model'.
2024/04/13 09:32:39 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-
bagging-clf-cv-model, version 1
Created version '1' of model 'sk-learn-bagging-clf-cv-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{54}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}bm\PYZus{}cv}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}bm\PYZus{}cv}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}bm\PYZus{}cv}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}bm\PYZus{}cv}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (Bagging Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust the bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Bagging Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Bagging Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \subparagraph{Testing Set}\label{testing-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{55}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Initializing the bagging model using SVM as the base model with default parameters}
    \PY{n}{bag\PYZus{}model} \PY{o}{=} \PY{n}{BaggingClassifier}\PY{p}{(}
        \PY{n}{svm\PYZus{}model}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{,} \PY{n}{n\PYZus{}estimators}\PY{o}{=}\PY{l+m+mi}{10}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Training the model}
    \PY{n}{bag\PYZus{}model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Predicting the output on the test dataset}
    \PY{n}{y\PYZus{}pred\PYZus{}bm} \PY{o}{=} \PY{n}{bag\PYZus{}model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Calculate metrics}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}bm}\PY{p}{)}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}bm}\PY{p}{)}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Recall}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}bm}\PY{p}{)}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}bm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Attempt to calculate the ROC AUC Score if probabilities can be estimated}
    \PY{k}{try}\PY{p}{:}
        \PY{n}{y\PYZus{}scores\PYZus{}bm} \PY{o}{=} \PY{n}{bag\PYZus{}model}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
        \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}bm}\PY{p}{)}
    \PY{k}{except} \PY{n+ne}{AttributeError} \PY{k}{as} \PY{n}{e}\PY{p}{:}
        \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{l+m+mf}{0.00}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC AUC Score is not applicable for this configuration without predict\PYZus{}proba:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{e}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Update ensemble\PYZus{}df DataFrame}
    \PY{n}{ensemble\PYZus{}df} \PY{o}{=} \PY{n}{ensemble\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Bagging Classifier with SVM}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the test set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Bagging Classifier with SVM: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}bm}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{bag\PYZus{}model}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Bagging Classifier with SVM}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{bag\PYZus{}model}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}Bagging Classifier with SVM\PYZdq{}, ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(bag\PYZus{}model, \PYZdq{}Bagging Classifier with SVM\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}bm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{bag\PYZus{}model}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}logistic\PYZhy{}reg\PYZhy{}cv\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Bagging Classifier with SVM:
              precision    recall  f1-score   support

           0       0.91      0.57      0.70        35
           1       0.69      0.94      0.80        35

    accuracy                           0.76        70
   macro avg       0.80      0.76      0.75        70
weighted avg       0.80      0.76      0.75        70

Confusion Matrix:
[[20 15]
 [ 2 33]]
Run ID: e60d59fa046b45a7aa4ef3ecb26faa72
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Registered model 'sk-learn-logistic-reg-cv-model' already exists. Creating a new
version of this model{\ldots}
2024/04/13 09:33:33 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-
logistic-reg-cv-model, version 4
Created version '4' of model 'sk-learn-logistic-reg-cv-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{56}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}bm}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}bm}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}bm}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}bm}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (Bagging Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust the bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Bagging Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Bagging Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \paragraph{GBM Classifier}\label{gbm-classifier}

    \subparagraph{Cross-Validation Set}\label{cross-validation-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{57}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Initializing the Gradient Boosting classifier with default parameters}
    \PY{n}{gb\PYZus{}model\PYZus{}cv} \PY{o}{=} \PY{n}{GradientBoostingClassifier}\PY{p}{(}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Training the model on the training dataset}
    \PY{n}{gb\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Predicting the output on the test dataset}
    \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}gb\PYZus{}cv} \PY{o}{=} \PY{n}{gb\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Get probability scores for AUC calculation}
    \PY{n}{y\PYZus{}scores\PYZus{}gb\PYZus{}cv} \PY{o}{=} \PY{n}{gb\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Calculate metrics}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}gb\PYZus{}cv}\PY{p}{)}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}gb\PYZus{}cv}\PY{p}{)}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Recall}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}gb\PYZus{}cv}\PY{p}{)}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}gb\PYZus{}cv}\PY{p}{)}
    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}gb\PYZus{}cv}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Use probability scores for AUC}

    \PY{c+c1}{\PYZsh{} Update ensemble\PYZus{}df DataFrame with new metrics}
    \PY{n}{ensemble\PYZus{}df} \PY{o}{=} \PY{n}{ensemble\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Gradient Boosting Classifier CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the validation set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Gradient Boosting Classifier CV: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}gb\PYZus{}cv}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{gb\PYZus{}model\PYZus{}cv}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Gradient Boosting Classifier CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{gb\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}Stacking Ensemble Models CV\PYZdq{}, ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(gb\PYZus{}model\PYZus{}cv, \PYZdq{}Stacking Ensemble Models CV\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}gb\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{gb\PYZus{}model\PYZus{}cv}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}gbm\PYZhy{}clf\PYZhy{}cv\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Gradient Boosting Classifier CV:
              precision    recall  f1-score   support

           0       0.90      0.79      0.84        33
           1       0.83      0.92      0.87        37

    accuracy                           0.86        70
   macro avg       0.86      0.85      0.86        70
weighted avg       0.86      0.86      0.86        70

Confusion Matrix:
[[26  7]
 [ 3 34]]
Run ID: b30e5c7a74ab4d8c82725441e31571ad
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Successfully registered model 'sk-learn-gbm-clf-cv-model'.
2024/04/13 09:33:44 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-gbm-
clf-cv-model, version 1
Created version '1' of model 'sk-learn-gbm-clf-cv-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{58}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}gb\PYZus{}cv}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}gb\PYZus{}cv}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}gb\PYZus{}cv}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}gb\PYZus{}cv}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (Gradient Boosting Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust the bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Gradient Boosting Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Gradient Boosting Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \subparagraph{Testing Set}\label{testing-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{59}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Initializing the Gradient Boosting classifier with default parameters}
    \PY{n}{gb\PYZus{}model} \PY{o}{=} \PY{n}{GradientBoostingClassifier}\PY{p}{(}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Training the model on the training dataset}
    \PY{n}{gb\PYZus{}model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Predicting the output on the test dataset}
    \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}gb} \PY{o}{=} \PY{n}{gb\PYZus{}model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Get probability scores for AUC calculation}
    \PY{n}{y\PYZus{}scores\PYZus{}gb} \PY{o}{=} \PY{n}{gb\PYZus{}model}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Calculate metrics}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}gb}\PY{p}{)}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}gb}\PY{p}{)}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Recall}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}gb}\PY{p}{)}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}gb}\PY{p}{)}
    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}gb}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Use probability scores for AUC}

    \PY{c+c1}{\PYZsh{} Update ensemble\PYZus{}df DataFrame with new metrics}
    \PY{n}{ensemble\PYZus{}df} \PY{o}{=} \PY{n}{ensemble\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Gradient Boosting Classifier}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the test set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Gradient Boosting Classifier: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}gb}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{gb\PYZus{}model}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Gradient Boosting Classifier}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{gb\PYZus{}model}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}Gradient Boosting Classifier\PYZdq{}, ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(gb\PYZus{}model, \PYZdq{}Gradient Boosting Classifier\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}gb}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{gb\PYZus{}model}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}gbm\PYZhy{}clf\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Gradient Boosting Classifier:
              precision    recall  f1-score   support

           0       0.89      0.69      0.77        35
           1       0.74      0.91      0.82        35

    accuracy                           0.80        70
   macro avg       0.82      0.80      0.80        70
weighted avg       0.82      0.80      0.80        70

Confusion Matrix:
[[24 11]
 [ 3 32]]
Run ID: 30e0c4947d804da9a9a3c5fb5a125327
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Successfully registered model 'sk-learn-gbm-clf-model'.
2024/04/13 09:33:55 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-gbm-
clf-model, version 1
Created version '1' of model 'sk-learn-gbm-clf-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{60}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}gb}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}gb}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}gb}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}gb}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (Gradient Boosting Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust the bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Gradient Boosting Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Gradient Boosting Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \paragraph{XGBoost Classifier}\label{xgboost-classifier}

    \subparagraph{Cross-Validation Set}\label{cross-validation-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{61}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Initializing the XGBoost classifier with default parameters}
    \PY{n}{xgb\PYZus{}model\PYZus{}cv} \PY{o}{=} \PY{n}{XGBClassifier}\PY{p}{(}\PY{n}{use\PYZus{}label\PYZus{}encoder}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{eval\PYZus{}metric}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{logloss}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Training the model on the train dataset}
    \PY{n}{xgb\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Predicting the output on the test dataset}
    \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}xgb\PYZus{}cv} \PY{o}{=} \PY{n}{xgb\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Get probability scores for AUC calculation}
    \PY{n}{y\PYZus{}scores\PYZus{}xgb\PYZus{}cv} \PY{o}{=} \PY{n}{xgb\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Calculate metrics}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}xgb\PYZus{}cv}\PY{p}{)}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}xgb\PYZus{}cv}\PY{p}{)}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Recall}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}xgb\PYZus{}cv}\PY{p}{)}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}xgb\PYZus{}cv}\PY{p}{)}
    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}xgb\PYZus{}cv}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Use probability scores for AUC}

    \PY{c+c1}{\PYZsh{} Update ensemble\PYZus{}df DataFrame}
    \PY{n}{ensemble\PYZus{}df} \PY{o}{=} \PY{n}{ensemble\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{XGBoost Classifier CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the validation set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{XGBoost Classifier CV: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}xgb\PYZus{}cv}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{xgb\PYZus{}model\PYZus{}cv}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{XGBoost Classifier CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{xgb\PYZus{}model\PYZus{}cv}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}XGBoost Classifier CV\PYZdq{}, ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.xgboost.save\PYZus{}model(xgb\PYZus{}model\PYZus{}cv, \PYZdq{}XGBoost Classifier CV\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}xgb\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{xgboost}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{xgb\PYZus{}model}\PY{o}{=}\PY{n}{xgb\PYZus{}model\PYZus{}cv}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{xgboost\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{xgboost\PYZhy{}clf\PYZhy{}cv\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
XGBoost Classifier CV:
              precision    recall  f1-score   support

           0       0.93      0.79      0.85        33
           1       0.83      0.95      0.89        37

    accuracy                           0.87        70
   macro avg       0.88      0.87      0.87        70
weighted avg       0.88      0.87      0.87        70

Confusion Matrix:
[[26  7]
 [ 2 35]]
Run ID: ec658a59d257429f884978c8078a7e57
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Successfully registered model 'xgboost-clf-cv-model'.
2024/04/13 09:34:06 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: xgboost-clf-cv-
model, version 1
Created version '1' of model 'xgboost-clf-cv-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{62}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}xgb\PYZus{}cv}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}xgb\PYZus{}cv}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}xgb\PYZus{}cv}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}xgb\PYZus{}cv}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (Extreme Gradient Boosting (XGB) Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust the bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Extreme Gradient Boosting (XGB) Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Extreme Gradient Boosting (XGB) Classifier on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \subparagraph{Testing Set}\label{testing-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{63}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Initializing the XGBoost classifier with default parameters}
    \PY{n}{xgb\PYZus{}model} \PY{o}{=} \PY{n}{XGBClassifier}\PY{p}{(}\PY{n}{use\PYZus{}label\PYZus{}encoder}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{eval\PYZus{}metric}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logloss}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Training the model on the train dataset}
    \PY{n}{xgb\PYZus{}model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Predicting the output on the test dataset}
    \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}xgb} \PY{o}{=} \PY{n}{xgb\PYZus{}model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Get probability scores for AUC calculation}
    \PY{n}{y\PYZus{}scores\PYZus{}xgb} \PY{o}{=} \PY{n}{xgb\PYZus{}model}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Calculate metrics}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}xgb}\PY{p}{)}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}xgb}\PY{p}{)}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Recall}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}xgb}\PY{p}{)}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}xgb}\PY{p}{)}
    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}xgb}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Use probability scores for AUC}

    \PY{c+c1}{\PYZsh{} Update ensemble\PYZus{}df DataFrame}
    \PY{n}{ensemble\PYZus{}df} \PY{o}{=} \PY{n}{ensemble\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{XGBoost Classifier}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the test set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{XGBoost Classifier: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}xgb}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{xgb\PYZus{}model}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{XGBoost Classifier}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{xgb\PYZus{}model}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}
    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}XGBoost Classifier\PYZdq{}, ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.xgboost.save\PYZus{}model(xgb\PYZus{}model, \PYZdq{}XGBoost Classifier\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}xgb}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{xgboost}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{xgb\PYZus{}model}\PY{o}{=}\PY{n}{xgb\PYZus{}model}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{xgboost\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{xgboost\PYZhy{}clf\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
XGBoost Classifier:
              precision    recall  f1-score   support

           0       0.87      0.77      0.82        35
           1       0.79      0.89      0.84        35

    accuracy                           0.83        70
   macro avg       0.83      0.83      0.83        70
weighted avg       0.83      0.83      0.83        70

Confusion Matrix:
[[27  8]
 [ 4 31]]
Run ID: adea379a4e7240568337726659dce869
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Successfully registered model 'xgboost-clf-model'.
2024/04/13 09:34:17 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: xgboost-clf-
model, version 1
Created version '1' of model 'xgboost-clf-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{64}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}xgb}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}xgb}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}xgb}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}xgb}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (Extreme Gradient Boosting (XGB) Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust the bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Extreme Gradient Boosting (XGB) Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Extreme Gradient Boosting (XGB) Classifier): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \paragraph{Stacking Classifier (using Baseline
Models)}\label{stacking-classifier-using-baseline-models}

    \subparagraph{Cross-Validation Set}\label{cross-validation-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{65}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Define baseline learners}
    \PY{n}{base\PYZus{}learners} \PY{o}{=} \PY{p}{[}
        \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lr\PYZus{}clf\PYZus{}cv}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{lr\PYZus{}clf\PYZus{}cv}\PY{p}{)}\PY{p}{,}
        \PY{p}{(}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{svm\PYZus{}model\PYZus{}cv}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{n}{svm\PYZus{}model\PYZus{}cv}\PY{p}{,}
        \PY{p}{)}\PY{p}{,}  \PY{c+c1}{\PYZsh{} Ensure svm\PYZus{}model is trained with probability=True for AUC scoring}
        \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{knn\PYZus{}model\PYZus{}cv}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{knn\PYZus{}model\PYZus{}cv}\PY{p}{)}\PY{p}{,}
        \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dt\PYZus{}clf\PYZus{}cv}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{dt\PYZus{}clf\PYZus{}cv}\PY{p}{)}\PY{p}{,}
    \PY{p}{]}

    \PY{c+c1}{\PYZsh{} Initialize the Stacking Classifier with the base learners and a final estimator}
    \PY{n}{final\PYZus{}estimator} \PY{o}{=} \PY{n}{DecisionTreeClassifier}\PY{p}{(}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{)}
    \PY{n}{stack\PYZus{}baseline\PYZus{}models\PYZus{}cv} \PY{o}{=} \PY{n}{StackingClassifier}\PY{p}{(}
        \PY{n}{estimators}\PY{o}{=}\PY{n}{base\PYZus{}learners}\PY{p}{,} \PY{n}{final\PYZus{}estimator}\PY{o}{=}\PY{n}{final\PYZus{}estimator}\PY{p}{,} \PY{n}{cv}\PY{o}{=}\PY{l+m+mi}{5}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Fit the stack model}
    \PY{n}{stack\PYZus{}baseline\PYZus{}models\PYZus{}cv}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Predict on the test set}
    \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}am\PYZus{}cv} \PY{o}{=} \PY{n}{stack\PYZus{}baseline\PYZus{}models\PYZus{}cv}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}
    \PY{n}{y\PYZus{}scores\PYZus{}am\PYZus{}cv} \PY{o}{=} \PY{n}{stack\PYZus{}baseline\PYZus{}models\PYZus{}cv}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}\PY{p}{[}
        \PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}
    \PY{p}{]}  \PY{c+c1}{\PYZsh{} Get probabilities for AUC scoring}

    \PY{c+c1}{\PYZsh{} Calculate metrics}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}am\PYZus{}cv}\PY{p}{)}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}am\PYZus{}cv}\PY{p}{)}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Recall}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{n}{roc\PYZus{}score} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}am\PYZus{}cv}\PY{p}{)}
    \PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}am\PYZus{}cv}\PY{p}{)}
    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}
    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}am\PYZus{}cv}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Corrected to use predictions}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}am\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Update DataFrame or similar storage}
    \PY{n}{ensemble\PYZus{}df} \PY{o}{=} \PY{n}{ensemble\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Stacking Baseline Models CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}score}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the validation set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Stacking Baseline Models CV: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}am\PYZus{}cv}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{stack\PYZus{}baseline\PYZus{}models\PYZus{}cv}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Stacking Baseline Models CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{stack\PYZus{}baseline\PYZus{}models\PYZus{}cv}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}Stacking Baseline Models CV\PYZdq{}, ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(stack\PYZus{}baseline\PYZus{}models\PYZus{}cv, \PYZdq{}Stacking Baseline Models CV\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}am\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{stack\PYZus{}baseline\PYZus{}models\PYZus{}cv}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}stack\PYZhy{}baseline\PYZhy{}cv\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Stacking Baseline Models CV:
              precision    recall  f1-score   support

           0       0.66      0.82      0.73        33
           1       0.79      0.62      0.70        37

    accuracy                           0.71        70
   macro avg       0.73      0.72      0.71        70
weighted avg       0.73      0.71      0.71        70


Confusion Matrix:
[[27  6]
 [14 23]]
Run ID: 69d78dc9412c4926bc56c2f671d62ac7
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Successfully registered model 'sk-learn-stack-baseline-cv-model'.
2024/04/13 09:34:54 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-stack-
baseline-cv-model, version 1
Created version '1' of model 'sk-learn-stack-baseline-cv-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{66}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}am\PYZus{}cv}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}am\PYZus{}cv}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}am\PYZus{}cv}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}am\PYZus{}cv}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (Stacking Classifier }\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{Baseline Models\PYZcb{} on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust the bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Stacking Classifier \PYZob{}Baseline Models\PYZcb{} on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Stacking Classifier \PYZob{}Baseline Models\PYZcb{} on Cross\PYZhy{}Validation Set): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \subparagraph{Testing Set}\label{testing-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{67}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Define base learners}
    \PY{n}{baseline\PYZus{}learners} \PY{o}{=} \PY{p}{[}
        \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lr\PYZus{}clf}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{lr\PYZus{}clf}\PY{p}{)}\PY{p}{,}
        \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{svm\PYZus{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{svm\PYZus{}model}\PY{p}{)}\PY{p}{,}  \PY{c+c1}{\PYZsh{} Ensure svm\PYZus{}model is trained with probability=True for AUC scoring}
        \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{knn\PYZus{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{knn\PYZus{}model}\PY{p}{)}\PY{p}{,}
        \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dt\PYZus{}clf}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{dt\PYZus{}clf}\PY{p}{)}\PY{p}{,}
    \PY{p}{]}

    \PY{c+c1}{\PYZsh{} Initialize the Stacking Classifier with the base learners and a final estimator}
    \PY{n}{final\PYZus{}estimator} \PY{o}{=} \PY{n}{DecisionTreeClassifier}\PY{p}{(}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{)}
    \PY{n}{stack\PYZus{}baseline\PYZus{}models} \PY{o}{=} \PY{n}{StackingClassifier}\PY{p}{(}
        \PY{n}{estimators}\PY{o}{=}\PY{n}{baseline\PYZus{}learners}\PY{p}{,} \PY{n}{final\PYZus{}estimator}\PY{o}{=}\PY{n}{final\PYZus{}estimator}\PY{p}{,} \PY{n}{cv}\PY{o}{=}\PY{l+m+mi}{5}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Fit the stack model}
    \PY{n}{stack\PYZus{}baseline\PYZus{}models}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Predict on the test set}
    \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}am} \PY{o}{=} \PY{n}{stack\PYZus{}baseline\PYZus{}models}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
    \PY{n}{y\PYZus{}scores\PYZus{}am} \PY{o}{=} \PY{n}{stack\PYZus{}baseline\PYZus{}models}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{[}
        \PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}
    \PY{p}{]}  \PY{c+c1}{\PYZsh{} Get probabilities for AUC scoring}

    \PY{c+c1}{\PYZsh{} Calculate metrics}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}am}\PY{p}{)}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}am}\PY{p}{)}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Recall}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{n}{roc\PYZus{}score} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}am}\PY{p}{)}
    \PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}am}\PY{p}{)}
    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}
    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}am}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Corrected to use predictions}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}am}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Update DataFrame or similar storage}
    \PY{n}{ensemble\PYZus{}df} \PY{o}{=} \PY{n}{ensemble\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Stacking Base Models}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}score}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the test set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Stacking Baseline Models: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}am}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{stack\PYZus{}baseline\PYZus{}models}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Stacking Baseline Models}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{stack\PYZus{}baseline\PYZus{}models}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}Stacking Baseline Models\PYZdq{},  ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(stack\PYZus{}baseline\PYZus{}models, \PYZdq{}Stacking Baseline Models\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}am}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{stack\PYZus{}baseline\PYZus{}models}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}stack\PYZhy{}baseline\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Stacking Baseline Models:
              precision    recall  f1-score   support

           0       0.69      0.63      0.66        35
           1       0.66      0.71      0.68        35

    accuracy                           0.67        70
   macro avg       0.67      0.67      0.67        70
weighted avg       0.67      0.67      0.67        70


Confusion Matrix:
[[22 13]
 [10 25]]
Run ID: f7cbd14ce8fb423b97b6bafed92f2266
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Successfully registered model 'sk-learn-stack-baseline-model'.
2024/04/13 09:35:28 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-stack-
baseline-model, version 1
Created version '1' of model 'sk-learn-stack-baseline-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{68}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}am}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}am}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}am}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}am}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (Stacking Classifier }\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{Baseline Models\PYZcb{}): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust the bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Stacking Classifier \PYZob{}Baseline Models\PYZcb{}): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Stacking Classifier \PYZob{}Baseline Models\PYZcb{}): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \paragraph{Stacking Classifier (using ensemble
models)}\label{stacking-classifier-using-ensemble-models}

    \subparagraph{Cross-Validation Set}\label{cross-validation-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{69}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Define the stacking ensemble model}
    \PY{n}{stack\PYZus{}ensemble\PYZus{}models\PYZus{}cv} \PY{o}{=} \PY{n}{StackingClassifier}\PY{p}{(}
        \PY{n}{estimators}\PY{o}{=}\PY{p}{[}
            \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{xgb\PYZus{}model\PYZus{}cv}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{xgb\PYZus{}model\PYZus{}cv}\PY{p}{)}\PY{p}{,}
            \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gbm\PYZus{}model\PYZus{}cv}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{gb\PYZus{}model\PYZus{}cv}\PY{p}{)}\PY{p}{,}
            \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{vote\PYZus{}model\PYZus{}cv}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{vote\PYZus{}model\PYZus{}soft\PYZus{}cv}\PY{p}{)}\PY{p}{,}
            \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{bag\PYZus{}model\PYZus{}cv}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{bag\PYZus{}model\PYZus{}cv}\PY{p}{)}\PY{p}{,}
        \PY{p}{]}\PY{p}{,}
        \PY{n}{final\PYZus{}estimator}\PY{o}{=}\PY{n}{XGBClassifier}\PY{p}{(}\PY{n}{use\PYZus{}label\PYZus{}encoder}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{eval\PYZus{}metric}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{logloss}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
        \PY{n}{cv}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Fit the stacking model}
    \PY{n}{stack\PYZus{}ensemble\PYZus{}models\PYZus{}cv}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Predicting the final output using stacking}
    \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}ams\PYZus{}cv} \PY{o}{=} \PY{n}{stack\PYZus{}ensemble\PYZus{}models\PYZus{}cv}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Get probability scores for AUC calculation}
    \PY{n}{y\PYZus{}scores\PYZus{}ams\PYZus{}cv} \PY{o}{=} \PY{n}{stack\PYZus{}ensemble\PYZus{}models\PYZus{}cv}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Calculate accuracy score}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}ams\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Confusion Matrix}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}ams\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Calculate specificity and other metrics}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Recall}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}ams\PYZus{}cv}\PY{p}{)}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}ams\PYZus{}cv}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Calculate F1\PYZhy{}Score}
    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}ams\PYZus{}cv}\PY{p}{)}  \PY{c+c1}{\PYZsh{} AUC score}

    \PY{c+c1}{\PYZsh{} Update ensemble\PYZus{}df DataFrame with new metrics}
    \PY{n}{ensemble\PYZus{}df} \PY{o}{=} \PY{n}{ensemble\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Stacking Ensemble Models CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,}
        \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the validation set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Stacking Ensemble Models CV: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}ams\PYZus{}cv}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{stack\PYZus{}ensemble\PYZus{}models\PYZus{}cv}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Stacking Ensemble Models CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{stack\PYZus{}ensemble\PYZus{}models\PYZus{}cv}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}Stacking Ensemble Models CV\PYZdq{}, ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(stack\PYZus{}ensemble\PYZus{}models\PYZus{}cv, \PYZdq{}Stacking Ensemble Models CV\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}ams\PYZus{}cv}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{stack\PYZus{}ensemble\PYZus{}models\PYZus{}cv}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}stack\PYZhy{}ensemble\PYZhy{}model\PYZhy{}cv}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Stacking Ensemble Models CV:
              precision    recall  f1-score   support

           0       0.83      0.73      0.77        33
           1       0.78      0.86      0.82        37

    accuracy                           0.80        70
   macro avg       0.80      0.80      0.80        70
weighted avg       0.80      0.80      0.80        70

Confusion Matrix:
[[24  9]
 [ 5 32]]
Run ID: 008f4b945fb846eaa43a2793f1d898f7
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Successfully registered model 'sk-learn-stack-ensemble-model-cv'.
2024/04/13 09:38:51 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-stack-
ensemble-model-cv, version 1
Created version '1' of model 'sk-learn-stack-ensemble-model-cv'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{70}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}ams\PYZus{}cv}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}ams\PYZus{}cv}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}ams\PYZus{}cv}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}ams\PYZus{}cv}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (Stacking Classifier }\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{Ensemble Models\PYZcb{} on Cross\PYZhy{}Validation): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust the bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Stacking Classifier \PYZob{}Ensemble Models\PYZcb{} on Cross\PYZhy{}Validation): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Stacking Classifier \PYZob{}Ensemble Models\PYZcb{} on Cross\PYZhy{}Validation): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \subparagraph{Testing Set}\label{testing-set}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{71}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n}{mlflow}\PY{o}{.}\PY{n}{start\PYZus{}run}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{run}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Define the stacking ensemble model}
    \PY{n}{stack\PYZus{}ensemble\PYZus{}models} \PY{o}{=} \PY{n}{StackingClassifier}\PY{p}{(}
        \PY{n}{estimators}\PY{o}{=}\PY{p}{[}
            \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{xgb\PYZus{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{xgb\PYZus{}model}\PY{p}{)}\PY{p}{,}
            \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gbm\PYZus{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{gb\PYZus{}model}\PY{p}{)}\PY{p}{,}
            \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{vote\PYZus{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{vote\PYZus{}model\PYZus{}soft}\PY{p}{)}\PY{p}{,}
            \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{bag\PYZus{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{bag\PYZus{}model}\PY{p}{)}\PY{p}{,}
        \PY{p}{]}\PY{p}{,}
        \PY{n}{final\PYZus{}estimator}\PY{o}{=}\PY{n}{XGBClassifier}\PY{p}{(}\PY{n}{use\PYZus{}label\PYZus{}encoder}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{eval\PYZus{}metric}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{logloss}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
        \PY{n}{cv}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Fit the stacking model}
    \PY{n}{stack\PYZus{}ensemble\PYZus{}models}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Predicting the final output using stacking}
    \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}ams} \PY{o}{=} \PY{n}{stack\PYZus{}ensemble\PYZus{}models}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Get probability scores for AUC calculation}
    \PY{n}{y\PYZus{}scores\PYZus{}ams} \PY{o}{=} \PY{n}{stack\PYZus{}ensemble\PYZus{}models}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Calculate accuracy score}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}ams}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Confusion Matrix}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}ams}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Calculate specificity and other metrics}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Recall}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}

    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}ams}\PY{p}{)}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}ams}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Calculate F1\PYZhy{}Score}
    \PY{n}{roc\PYZus{}auc} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}ams}\PY{p}{)}  \PY{c+c1}{\PYZsh{} AUC score}

    \PY{c+c1}{\PYZsh{} Update ensemble\PYZus{}df DataFrame with new metrics}
    \PY{n}{ensemble\PYZus{}df} \PY{o}{=} \PY{n}{ensemble\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Stacking Ensemble Models}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{p}{\PYZcb{}}\PY{p}{,} \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Evaluate the model on the test set}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Stacking Ensemble Models: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}ams}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Confusion Matrix: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{cm}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the model parameters and metrics to MLflow}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}\PY{n}{stack\PYZus{}ensemble\PYZus{}models}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Stacking Ensemble Models}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Run ID: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{run}\PY{o}{.}\PY{n}{info}\PY{o}{.}\PY{n}{run\PYZus{}id}\PY{p}{)}\PY{p}{)}

    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}params}\PY{p}{(}\PY{n}{stack\PYZus{}ensemble\PYZus{}models}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{log\PYZus{}metrics}\PY{p}{(}
        \PY{p}{\PYZob{}}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}auc}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}
        \PY{p}{\PYZcb{}}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Save the model to MLflow}
    \PY{c+c1}{\PYZsh{}shutil.rmtree(\PYZdq{}Stacking Ensemble Models\PYZdq{}, ignore\PYZus{}errors=True)}
    \PY{c+c1}{\PYZsh{}mlflow.sklearn.save\PYZus{}model(stack\PYZus{}ensemble\PYZus{}models, \PYZdq{}Stacking Ensemble Models\PYZdq{})}

    \PY{n}{signature} \PY{o}{=} \PY{n}{infer\PYZus{}signature}\PY{p}{(}\PY{n}{X\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}ams}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log the sklearn model and register as version 1}
    \PY{n}{mlflow}\PY{o}{.}\PY{n}{sklearn}\PY{o}{.}\PY{n}{log\PYZus{}model}\PY{p}{(}
        \PY{n}{sk\PYZus{}model}\PY{o}{=}\PY{n}{stack\PYZus{}ensemble\PYZus{}models}\PY{p}{,}
        \PY{n}{artifact\PYZus{}path}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sklearn\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{signature}\PY{o}{=}\PY{n}{signature}\PY{p}{,}
        \PY{n}{registered\PYZus{}model\PYZus{}name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{sk\PYZhy{}learn\PYZhy{}stack\PYZhy{}ensemble\PYZhy{}model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Stacking Ensemble Models:
              precision    recall  f1-score   support

           0       0.96      0.63      0.76        35
           1       0.72      0.97      0.83        35

    accuracy                           0.80        70
   macro avg       0.84      0.80      0.79        70
weighted avg       0.84      0.80      0.79        70

Confusion Matrix:
[[22 13]
 [ 1 34]]
Run ID: 0f412b27cbb44d89a073d1f48bda8d61
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Successfully registered model 'sk-learn-stack-ensemble-model'.
2024/04/13 09:41:53 INFO mlflow.store.model\_registry.abstract\_store: Waiting up
to 300 seconds for model version to finish creation. Model name: sk-learn-stack-
ensemble-model, version 1
Created version '1' of model 'sk-learn-stack-ensemble-model'.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{72}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Calculate metrics for ROC\PYZhy{}AUC Curve}
\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{roc\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}ams}\PY{p}{)}
\PY{n}{roc\PYZus{}auc\PYZus{}val} \PY{o}{=} \PY{n}{auc}\PY{p}{(}\PY{n}{fpr}\PY{p}{,} \PY{n}{tpr}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate metrics for Precision\PYZhy{}Recall Curve}
\PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{precision\PYZus{}recall\PYZus{}curve}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}ams}\PY{p}{)}
\PY{n}{pr\PYZus{}auc} \PY{o}{=} \PY{n}{average\PYZus{}precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}scores\PYZus{}ams}\PY{p}{)}
\PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}final\PYZus{}ams}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC\PYZhy{}AUC Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall Curve}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add ROC\PYZhy{}AUC Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{fpr}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{tpr}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ROC curve (AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC = }\PY{l+s+si}{\PYZob{}}\PY{n}{roc\PYZus{}auc\PYZus{}val}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Add Precision\PYZhy{}Recall Curve to the subplot}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{recall}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{precision}\PY{p}{,}
        \PY{n}{mode}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lines}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision\PYZhy{}Recall curve (AP = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{n}{fill}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{tozeroy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average Precision = }\PY{l+s+si}{\PYZob{}}\PY{n}{pr\PYZus{}auc}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{green}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}annotation}\PY{p}{(}
    \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.2}\PY{p}{,}
    \PY{n}{y}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.20}\PY{p}{,}
    \PY{n}{xref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{yref}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paper}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{text}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score = }\PY{l+s+si}{\PYZob{}}\PY{n}{f1}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showarrow}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance (Stacking Classifier }\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{Ensemble Models\PYZcb{}): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{600}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{margin}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{b}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
\PY{p}{)}  \PY{c+c1}{\PYZsh{} Adjust the bottom margin to avoid cutting off annotations}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Stacking Classifier \PYZob{}Ensemble Models\PYZcb{}): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Model Performance (Stacking Classifier \PYZob{}Ensemble Models\PYZcb{}): ROC\PYZhy{}AUC and Precision\PYZhy{}Recall Curves.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plots side\PYZhy{}by\PYZhy{}side}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{73}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{ensemble\PYZus{}df}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{73}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
                     Ensemble Model  Accuracy  Sensitivity  Specificity  False
Positive Rate  Precision  AUC Score  F1-Score
0       Voting Classifier (Soft) CV  0.885714     0.945946     0.818182
0.181818   0.853659   0.928747  0.897436
8       Stacking Baseline Models CV  0.714286     0.621622     0.818182
0.181818   0.793103   0.719902  0.696970
4   Gradient Boosting Classifier CV  0.857143     0.918919     0.787879
0.212121   0.829268   0.935299  0.871795
6             XGBoost Classifier CV  0.871429     0.945946     0.787879
0.212121   0.833333   0.930385  0.886076
7                XGBoost Classifier  0.828571     0.885714     0.771429
0.228571   0.794872   0.908571  0.837838
10      Stacking Ensemble Models CV  0.800000     0.864865     0.727273
0.272727   0.780488   0.849304  0.820513
2    Bagging Classifier with SVM CV  0.828571     0.945946     0.696970
0.303030   0.777778   0.929566  0.853659
5      Gradient Boosting Classifier  0.800000     0.914286     0.685714
0.314286   0.744186   0.928980  0.820513
9              Stacking Base Models  0.671429     0.714286     0.628571
0.371429   0.657895   0.671429  0.684932
11         Stacking Ensemble Models  0.800000     0.971429     0.628571
0.371429   0.723404   0.867755  0.829268
1          Voting Classifier (Soft)  0.771429     0.942857     0.600000
0.400000   0.702128   0.844082  0.804878
3       Bagging Classifier with SVM  0.757143     0.942857     0.571429
0.428571   0.687500   0.822041  0.795181
\end{Verbatim}
\end{tcolorbox}
        
    \paragraph{Performance Metrics of Ensemble
Models}\label{performance-metrics-of-ensemble-models}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{74}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Define a list of colors for the ensemble models}
\PY{n}{colors} \PY{o}{=} \PY{p}{[}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rgba(255, 99, 132, 0.6)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rgba(54, 162, 235, 0.6)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rgba(255, 206, 86, 0.6)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rgba(75, 192, 192, 0.6)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rgba(153, 102, 255, 0.6)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rgba(255, 159, 64, 0.6)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
\PY{p}{]}

\PY{c+c1}{\PYZsh{} Map each ensemble model to a specific color}
\PY{n}{unique\PYZus{}models} \PY{o}{=} \PY{n}{ensemble\PYZus{}df}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{p}{)}
\PY{n}{color\PYZus{}map} \PY{o}{=} \PY{p}{\PYZob{}}\PY{n}{model}\PY{p}{:} \PY{n}{colors}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZpc{}} \PY{n+nb}{len}\PY{p}{(}\PY{n}{colors}\PY{p}{)}\PY{p}{]} \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{model} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{unique\PYZus{}models}\PY{p}{)}\PY{p}{\PYZcb{}}

\PY{c+c1}{\PYZsh{} Create Subplots for the model performance using the 6 evaluation metrics}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{,}
    \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
    \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy vs. Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity vs. Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity vs. Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate vs. Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision vs. Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score vs. Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score vs. Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{horizontal\PYZus{}spacing}\PY{o}{=}\PY{l+m+mf}{0.15}\PY{p}{,}
    \PY{n}{vertical\PYZus{}spacing}\PY{o}{=}\PY{l+m+mf}{0.15}\PY{p}{,}
\PY{p}{)}

\PY{n}{metrics} \PY{o}{=} \PY{p}{[}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
\PY{p}{]}
\PY{n}{plot\PYZus{}positions} \PY{o}{=} \PY{p}{[}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{]}

\PY{k}{for} \PY{n}{metric}\PY{p}{,} \PY{n}{pos} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{metrics}\PY{p}{,} \PY{n}{plot\PYZus{}positions}\PY{p}{)}\PY{p}{:}
    \PY{c+c1}{\PYZsh{} Sort the DataFrame based on the current metric in descending order}
    \PY{n}{df\PYZus{}sorted} \PY{o}{=} \PY{n}{ensemble\PYZus{}df}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{n}{by}\PY{o}{=}\PY{n}{metric}\PY{p}{,} \PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Extracting the sorted model names for consistent color mapping}
    \PY{n}{sorted\PYZus{}models} \PY{o}{=} \PY{n}{df\PYZus{}sorted}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Generate one bar for each model, now in sorted order}
    \PY{k}{for} \PY{n}{model} \PY{o+ow}{in} \PY{n}{sorted\PYZus{}models}\PY{p}{:}
        \PY{n}{df\PYZus{}filtered} \PY{o}{=} \PY{n}{df\PYZus{}sorted}\PY{p}{[}\PY{n}{df\PYZus{}sorted}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Ensemble Model}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{==} \PY{n}{model}\PY{p}{]}
        \PY{n}{show\PYZus{}legend} \PY{o}{=} \PY{p}{(}
            \PY{n}{metric} \PY{o}{==} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}
        \PY{p}{)}  \PY{c+c1}{\PYZsh{} Show legend only in the first subplot for clarity}
        \PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
            \PY{n}{go}\PY{o}{.}\PY{n}{Bar}\PY{p}{(}
                \PY{n}{x}\PY{o}{=}\PY{p}{[}\PY{n}{model}\PY{p}{]}\PY{p}{,}
                \PY{n}{y}\PY{o}{=}\PY{n}{df\PYZus{}filtered}\PY{p}{[}\PY{n}{metric}\PY{p}{]}\PY{p}{,}
                \PY{n}{name}\PY{o}{=}\PY{n}{model}\PY{p}{,}
                \PY{n}{marker\PYZus{}color}\PY{o}{=}\PY{n}{color\PYZus{}map}\PY{p}{[}\PY{n}{model}\PY{p}{]}\PY{p}{,}
                \PY{n}{text}\PY{o}{=}\PY{n}{df\PYZus{}filtered}\PY{p}{[}\PY{n}{metric}\PY{p}{]}\PY{o}{.}\PY{n}{round}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,}
                \PY{n}{textposition}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{outside}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
                \PY{n}{showlegend}\PY{o}{=}\PY{n}{show\PYZus{}legend}\PY{p}{,}
            \PY{p}{)}\PY{p}{,}
            \PY{n}{row}\PY{o}{=}\PY{n}{pos}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}
            \PY{n}{col}\PY{o}{=}\PY{n}{pos}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
        \PY{p}{)}

\PY{c+c1}{\PYZsh{} Update layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{1500}\PY{p}{,}
    \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{1100}\PY{p}{,}
    \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Performance Metrics of Ensemble Models}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{n}{showlegend}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
    \PY{n}{legend}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{orientation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{v}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{l+m+mf}{1.05}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{)}\PY{p}{,}
    \PY{n}{font}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{tickangle}\PY{o}{=}\PY{l+m+mi}{45}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n+nb}{range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Performance Metrics of Ensemble Models.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Ensemble\PYZus{}Models/Performance Metrics of Ensemble Models.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Display the plot}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    The \textbf{\emph{Extreme Gradient Boosting algorithm}} provided the
best performance among the six ensemble models in terms of 5 (out of 6)
evaluation metrics used.

    Conclusively, it was found that the ensemble models outperformed the
baseline models; while \textbf{Logistic Regression} being a base model
had the highest Specificity score (0.85), the \textbf{Extreme Gradient
Boosting algorithm (XGB)} being an ensemble model had the highest
overall Specificity score of 0.89.

    \subsubsection{\texorpdfstring{Assessing how the Number of Features
Impacts Model Performance
}{Assessing how the Number of Features Impacts Model Performance }}\label{assessing-how-the-number-of-features-impacts-model-performance}

This section of the code evaluates the performance of Decision Tree
models trained with varying numbers of features selected via the Minimum
Redundancy Maximum Relevance (MRMR) method, to ascertain the most
effective and efficient feature subset for detecting ovarian cancer
tumors. By iterating through a range of feature subsets and assessing
each model's performance with key metrics---Accuracy, Sensitivity,
Specificity, Precision, F1-Score, and AUC Score---the analysis aims to
identify the optimal number of features that contribute to the superior
performance of the models. The results, compiled into a DataFrame,
facilitate a comparative analysis to determine the most suitable
ensemble learning method for enhancing ovarian cancer detection.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{75}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Split data into training and validation sets}
\PY{n}{X}\PY{p}{,} \PY{n}{cancer\PYZus{}X\PYZus{}test}\PY{p}{,} \PY{n}{y}\PY{p}{,} \PY{n}{cancer\PYZus{}y\PYZus{}test} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{p}{,} \PY{n}{test\PYZus{}size}\PY{o}{=}\PY{l+m+mf}{0.3}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{76}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Create a dataframe to store the results}
\PY{n}{result\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{p}{[}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of Features}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
\PY{p}{]}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Loop over the number of features and train decision tree models on each subset}
\PY{k}{for} \PY{n}{n} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{49}\PY{p}{)}\PY{p}{:}
    \PY{c+c1}{\PYZsh{} Select a subset of features according to MRMR}
    \PY{n}{subset\PYZus{}features} \PY{o}{=} \PY{n}{mrmr\PYZus{}classif}\PY{p}{(}\PY{n}{X}\PY{o}{=}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{K}\PY{o}{=}\PY{n}{n}\PY{p}{)}
    
    \PY{c+c1}{\PYZsh{} Filter both training and test sets with the selected features}
    \PY{n}{X\PYZus{}train\PYZus{}subset} \PY{o}{=} \PY{n}{X\PYZus{}train}\PY{p}{[}\PY{n}{subset\PYZus{}features}\PY{p}{]}
    \PY{n}{X\PYZus{}test\PYZus{}subset} \PY{o}{=} \PY{n}{X\PYZus{}test}\PY{p}{[}\PY{n}{subset\PYZus{}features}\PY{p}{]}
    
    \PY{c+c1}{\PYZsh{} Train a Decision Tree model on the selected subset of features}
    \PY{n}{model} \PY{o}{=} \PY{n}{DecisionTreeClassifier}\PY{p}{(}\PY{p}{)}
    \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}subset}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}
    
    \PY{c+c1}{\PYZsh{} Predictions}
    \PY{n}{y\PYZus{}pred\PYZus{}loop} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}subset}\PY{p}{)}
    
    \PY{c+c1}{\PYZsh{} Calculate metrics}
    \PY{n}{cm} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}loop}\PY{p}{)}
    \PY{n}{TP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{TN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{FP} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{FN} \PY{o}{=} \PY{n}{cm}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sensitivity} \PY{o}{=} \PY{n}{TP} \PY{o}{/} \PY{p}{(}\PY{n}{TP} \PY{o}{+} \PY{n}{FN}\PY{p}{)}
    \PY{n}{specificity} \PY{o}{=} \PY{n}{TN} \PY{o}{/} \PY{p}{(}\PY{n}{TN} \PY{o}{+} \PY{n}{FP}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} False Positive Rate (FPR)}
    \PY{n}{FPR} \PY{o}{=} \PY{n}{FP} \PY{o}{/} \PY{p}{(}\PY{n}{FP} \PY{o}{+} \PY{n}{TN}\PY{p}{)}
    \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}loop}\PY{p}{)}
    \PY{n}{roc\PYZus{}score} \PY{o}{=} \PY{n}{roc\PYZus{}auc\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{model}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test\PYZus{}subset}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}loop}\PY{p}{)}
    \PY{n}{f1} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}pred\PYZus{}loop}\PY{p}{)}
    
    \PY{c+c1}{\PYZsh{} Append results to the dataframe}
    \PY{n}{result\PYZus{}df} \PY{o}{=} \PY{n}{result\PYZus{}df}\PY{o}{.}\PY{n}{\PYZus{}append}\PY{p}{(}\PY{p}{\PYZob{}}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of Features}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{n}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{accuracy}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{sensitivity}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{specificity}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{FPR}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{precision}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{f1}\PY{p}{,}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{roc\PYZus{}score}\PY{p}{,}
    \PY{p}{\PYZcb{}}\PY{p}{,} \PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
100\%|███████████████████████████████████████████████████████████████████████████
██████████████████████████████████████████████████████| 2/2 [00:00<00:00,
54.45it/s]
2024/04/13 09:42:00 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '4caf3ee471d94617bb9d2a14b90e0355', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
██████████████████████████████████████████████████████| 3/3 [00:00<00:00,
40.07it/s]
2024/04/13 09:42:07 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '24bea0f5fa704a1eb3d213a256891db3', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
██████████████████████████████████████████████████████| 4/4 [00:00<00:00,
72.84it/s]
2024/04/13 09:42:11 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID 'dd4fba6540c745ac9dbad3f8a685534f', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
██████████████████████████████████████████████████████| 5/5 [00:00<00:00,
66.65it/s]
2024/04/13 09:42:14 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '7199de06f4b54247a21cb9e7b649e3ab', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
██████████████████████████████████████████████████████| 6/6 [00:00<00:00,
57.89it/s]
2024/04/13 09:42:18 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '5ee7bd39833c44e5b76e3659b4a99aa6', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
██████████████████████████████████████████████████████| 7/7 [00:00<00:00,
30.22it/s]
2024/04/13 09:42:24 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '847169c881424d4da5cdd2ac2a6e2ebc', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
██████████████████████████████████████████████████████| 8/8 [00:00<00:00,
48.69it/s]
2024/04/13 09:42:31 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID 'd10cbcb0719244a4a35aee6be7af7a40', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
██████████████████████████████████████████████████████| 9/9 [00:00<00:00,
28.49it/s]
2024/04/13 09:42:37 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '552402b46d464003b2376a30a377790e', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 10/10 [00:00<00:00,
45.41it/s]
2024/04/13 09:42:42 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID 'dc01d7065f8f4c4d81bd1a3d00b7d8c4', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 11/11 [00:00<00:00,
45.08it/s]
2024/04/13 09:42:46 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '4e227a52a7ee4a91b5f19cc752611fde', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 12/12 [00:00<00:00,
42.74it/s]
2024/04/13 09:42:50 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '0bbd8a6acb064a92b15256a3a0e0a5ab', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 13/13 [00:00<00:00,
41.47it/s]
2024/04/13 09:42:56 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID 'c21fb052fc534d0698164a1f09bb58ae', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 14/14 [00:00<00:00,
23.83it/s]
2024/04/13 09:43:01 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '1d148964e6ce427ea0a779f550796584', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 15/15 [00:01<00:00,
14.54it/s]
2024/04/13 09:43:08 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '1ce06234d06b4a00ac616f8c9c67acaa', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 16/16 [00:01<00:00,
9.06it/s]
2024/04/13 09:43:18 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID 'da14961062af42768f0ec5b8c59e4bdd', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 17/17 [00:04<00:00,
3.40it/s]
2024/04/13 09:43:29 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '10b5714ecf8948f4b03680e0b95a89ef', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 18/18 [00:02<00:00,
6.42it/s]
2024/04/13 09:43:40 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '738f95a4c90b4dcab494893087cb1933', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 19/19 [00:04<00:00,
4.73it/s]
2024/04/13 09:43:52 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID 'c9a4845e44d042cfafd4f0e22a4f0a5b', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:03<00:00,
5.46it/s]
2024/04/13 09:44:04 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID 'd1b550f675e449199de9a2afc8fd4bd0', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:03<00:00,
5.24it/s]
2024/04/13 09:44:15 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID 'bb591675ac6540d188625cba329921d4', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:03<00:00,
5.40it/s]
2024/04/13 09:44:26 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '5afd4ffb17154dad94b464b4d771fe67', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:03<00:00,
5.11it/s]
2024/04/13 09:44:38 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '2de366a3313d40e9b09fc42e9991d7f5', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:03<00:00,
5.52it/s]
2024/04/13 09:44:49 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '7aee7c54e67746c284229f478a5dc528', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:03<00:00,
5.50it/s]
2024/04/13 09:45:00 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID 'd0eee3d851fa4332959622623f97b75a', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:03<00:00,
5.27it/s]
2024/04/13 09:45:11 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '7a0ca486a9e7448d8f2cbd1ffb2512f8', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:03<00:00,
5.57it/s]
2024/04/13 09:45:22 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID 'bccee9694b6342b9bf6bebc293cfbbbb', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:05<00:00,
3.74it/s]
2024/04/13 09:45:36 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '596e4eb2e1df4cc08a7193483b40e698', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:04<00:00,
4.68it/s]
2024/04/13 09:45:51 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '379e6cb8647a40539d3ed90caf4bcd85', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:04<00:00,
4.99it/s]
2024/04/13 09:46:06 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID 'f8d7bdf11e4440fa9c124ad3095f5000', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:03<00:00,
5.60it/s]
2024/04/13 09:46:16 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '87fe3f8bec164656a22b350a696bda3e', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:03<00:00,
5.27it/s]
2024/04/13 09:46:28 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '3af91427df2e42be83bf2b4bf5103b78', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:03<00:00,
5.19it/s]
2024/04/13 09:46:41 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID 'eca1b095936f481bbf688cf30c2ec8d5', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:04<00:00,
4.92it/s]
2024/04/13 09:46:54 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '250de7ad363341428562ddd0e9fcffbe', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:05<00:00,
3.55it/s]
2024/04/13 09:47:11 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID 'd3163e9f8a7f43a79664f1313da1ca32', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:04<00:00,
4.60it/s]
2024/04/13 09:47:26 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '66f0f782c8a34f6aaa449937bbf7b831', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:04<00:00,
4.34it/s]
2024/04/13 09:47:41 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID 'd90d4c9bf2cd4c58b2dbd0d551ce66ca', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:04<00:00,
4.71it/s]
2024/04/13 09:47:56 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '5343b2eb50c34f6a9d1181e49bb1500d', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:03<00:00,
5.20it/s]
2024/04/13 09:48:09 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '79fe3bddc81e4da49b28ca95c7e6bf03', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:04<00:00,
4.38it/s]
2024/04/13 09:48:21 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '0f32d602bb874f358d86a959632e5828', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:04<00:00,
4.55it/s]
2024/04/13 09:48:35 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID 'd9cf703286e241d7838dd4d139bb04c0', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:04<00:00,
4.22it/s]
2024/04/13 09:48:52 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '29583944f276423988f108102487c517', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:04<00:00,
4.47it/s]
2024/04/13 09:49:05 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '4ee648d15cc149b9ac17a2cc9f9aca7b', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:03<00:00,
5.43it/s]
2024/04/13 09:49:17 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '852c8a2b45564e559098af5de0cdb253', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:03<00:00,
5.06it/s]
2024/04/13 09:49:29 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '924b072d472c4f3787ff562c98583f89', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:05<00:00,
3.80it/s]
2024/04/13 09:49:43 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '07a3e8de86fc49bcacfeb95050551a9e', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:04<00:00,
4.49it/s]
2024/04/13 09:50:00 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID 'c3e41f41b31e414dbe5eb308e4e39a62', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
100\%|███████████████████████████████████████████████████████████████████████████
████████████████████████████████████████████████████| 20/20 [00:04<00:00,
4.78it/s]
2024/04/13 09:50:16 INFO mlflow.utils.autologging\_utils: Created MLflow
autologging run with ID '8adc75057a3c49f9820e44b08cdef42a', which will track
hyperparameters, performance metrics, model artifacts, and lineage information
for the current sklearn workflow
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{77}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Print the resulting dataframe}
\PY{n}{result\PYZus{}df}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{77}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
    Number of Features  Accuracy  Sensitivity  Specificity  False Positive Rate
Precision  F1-Score  AUC Score
1                  3.0  0.785714     0.771429     0.800000             0.200000
0.794118  0.782609   0.785714
2                  4.0  0.771429     0.771429     0.771429             0.228571
0.771429  0.771429   0.771429
3                  5.0  0.814286     0.857143     0.771429             0.228571
0.789474  0.821918   0.814286
15                17.0  0.785714     0.800000     0.771429             0.228571
0.777778  0.788732   0.785714
4                  6.0  0.800000     0.857143     0.742857             0.257143
0.769231  0.810811   0.800000
11                13.0  0.800000     0.857143     0.742857             0.257143
0.769231  0.810811   0.800000
7                  9.0  0.785714     0.828571     0.742857             0.257143
0.763158  0.794521   0.785714
45                47.0  0.828571     0.914286     0.742857             0.257143
0.780488  0.842105   0.828571
28                30.0  0.842857     0.942857     0.742857             0.257143
0.785714  0.857143   0.842857
16                18.0  0.785714     0.828571     0.742857             0.257143
0.763158  0.794521   0.785714
19                21.0  0.828571     0.942857     0.714286             0.285714
0.767442  0.846154   0.828571
12                14.0  0.757143     0.800000     0.714286             0.285714
0.736842  0.767123   0.757143
6                  8.0  0.771429     0.828571     0.714286             0.285714
0.743590  0.783784   0.771429
13                15.0  0.771429     0.828571     0.714286             0.285714
0.743590  0.783784   0.771429
5                  7.0  0.771429     0.828571     0.714286             0.285714
0.743590  0.783784   0.771429
46                48.0  0.828571     0.942857     0.714286             0.285714
0.767442  0.846154   0.828571
43                45.0  0.814286     0.914286     0.714286             0.285714
0.761905  0.831169   0.814286
39                41.0  0.828571     0.942857     0.714286             0.285714
0.767442  0.846154   0.828571
44                46.0  0.842857     0.971429     0.714286             0.285714
0.772727  0.860759   0.842857
41                43.0  0.828571     0.942857     0.714286             0.285714
0.767442  0.846154   0.828571
20                22.0  0.828571     0.942857     0.714286             0.285714
0.767442  0.846154   0.828571
23                25.0  0.828571     0.942857     0.714286             0.285714
0.767442  0.846154   0.828571
17                19.0  0.828571     0.942857     0.714286             0.285714
0.767442  0.846154   0.828571
27                29.0  0.828571     0.942857     0.714286             0.285714
0.767442  0.846154   0.828571
24                26.0  0.828571     0.942857     0.714286             0.285714
0.767442  0.846154   0.828571
25                27.0  0.842857     0.971429     0.714286             0.285714
0.772727  0.860759   0.842857
40                42.0  0.814286     0.914286     0.714286             0.285714
0.761905  0.831169   0.814286
33                35.0  0.828571     0.942857     0.714286             0.285714
0.767442  0.846154   0.828571
36                38.0  0.828571     0.942857     0.714286             0.285714
0.767442  0.846154   0.828571
32                34.0  0.814286     0.914286     0.714286             0.285714
0.761905  0.831169   0.814286
18                20.0  0.828571     0.942857     0.714286             0.285714
0.767442  0.846154   0.828571
35                37.0  0.814286     0.942857     0.685714             0.314286
0.750000  0.835443   0.814286
14                16.0  0.800000     0.914286     0.685714             0.314286
0.744186  0.820513   0.800000
9                 11.0  0.742857     0.800000     0.685714             0.314286
0.717949  0.756757   0.742857
8                 10.0  0.742857     0.800000     0.685714             0.314286
0.717949  0.756757   0.742857
10                12.0  0.714286     0.742857     0.685714             0.314286
0.702703  0.722222   0.714286
29                31.0  0.828571     0.971429     0.685714             0.314286
0.755556  0.850000   0.828571
34                36.0  0.814286     0.942857     0.685714             0.314286
0.750000  0.835443   0.814286
37                39.0  0.800000     0.914286     0.685714             0.314286
0.744186  0.820513   0.800000
42                44.0  0.800000     0.914286     0.685714             0.314286
0.744186  0.820513   0.800000
38                40.0  0.800000     0.942857     0.657143             0.342857
0.733333  0.825000   0.800000
22                24.0  0.785714     0.914286     0.657143             0.342857
0.727273  0.810127   0.785714
26                28.0  0.800000     0.942857     0.657143             0.342857
0.733333  0.825000   0.800000
31                33.0  0.814286     0.971429     0.657143             0.342857
0.739130  0.839506   0.814286
30                32.0  0.771429     0.914286     0.628571             0.371429
0.711111  0.800000   0.771429
21                23.0  0.771429     0.914286     0.628571             0.371429
0.711111  0.800000   0.771429
0                  2.0  0.542857     0.514286     0.571429             0.428571
0.545455  0.529412   0.542857
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{78}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Creating subplots}
\PY{n}{fig} \PY{o}{=} \PY{n}{make\PYZus{}subplots}\PY{p}{(}
    \PY{n}{rows}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{,}
    \PY{n}{cols}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
    \PY{n}{subplot\PYZus{}titles}\PY{o}{=}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
    \PY{n}{vertical\PYZus{}spacing}\PY{o}{=}\PY{l+m+mf}{0.09}\PY{p}{,}
    \PY{n}{horizontal\PYZus{}spacing}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Adding traces}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{result\PYZus{}df}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of Features}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{n}{result\PYZus{}df}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy}\PY{l+s+s2}{\PYZdq{}}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{result\PYZus{}df}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of Features}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{result\PYZus{}df}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sensitivity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{result\PYZus{}df}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of Features}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
        \PY{n}{y}\PY{o}{=}\PY{n}{result\PYZus{}df}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
        \PY{n}{name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Specificity}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{result\PYZus{}df}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of Features}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{n}{result\PYZus{}df}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision}\PY{l+s+s2}{\PYZdq{}}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{result\PYZus{}df}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of Features}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{n}{result\PYZus{}df}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}Score}\PY{l+s+s2}{\PYZdq{}}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{result\PYZus{}df}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of Features}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{n}{result\PYZus{}df}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AUC Score}\PY{l+s+s2}{\PYZdq{}}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}trace}\PY{p}{(}
    \PY{n}{go}\PY{o}{.}\PY{n}{Scatter}\PY{p}{(}
        \PY{n}{x}\PY{o}{=}\PY{n}{result\PYZus{}df}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of Features}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{n}{result\PYZus{}df}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{False Positive Rate}\PY{l+s+s2}{\PYZdq{}}
    \PY{p}{)}\PY{p}{,}
    \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{,}
    \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
\PY{p}{)}
\PY{c+c1}{\PYZsh{} Adjusting layout}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}layout}\PY{p}{(}
    \PY{n}{height}\PY{o}{=}\PY{l+m+mi}{1200}\PY{p}{,} \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{800}\PY{p}{,} \PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model Performance Metrics by Number of Features}\PY{l+s+s2}{\PYZdq{}}
\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of Features}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}xaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of Features}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{row}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{update\PYZus{}yaxes}\PY{p}{(}\PY{n}{title\PYZus{}text}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Metric Value}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{col}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Save plot}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Model Performance (Model Performance Metrics by Number of Features.png\PYZdq{}) \PYZsh{}png format}
\PY{c+c1}{\PYZsh{}fig.write\PYZus{}image(\PYZdq{}./charts/Model Performance (Model Performance Metrics by Number of Features.svg\PYZdq{}) \PYZsh{}svg format}

\PY{c+c1}{\PYZsh{} Show plot}
\PY{n}{fig}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]

\end{Verbatim}
\end{tcolorbox}


    % Add a bibliography block to the postdoc
    
    
    
\end{document}
